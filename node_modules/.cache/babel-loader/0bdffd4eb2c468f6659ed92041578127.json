{"ast":null,"code":"import { defineComponent, shallowRef, ref, computed, onMounted, provide, toRef, resolveComponent, openBlock, createElementBlock, normalizeClass, normalizeStyle, renderSlot, createElementVNode, toDisplayString, createCommentVNode, createVNode, withCtx, createTextVNode, createBlock } from \"vue\";\nimport { u as useBem } from \"../../composables/useBem.js\";\nimport { u as useColors } from \"../../composables/useColors.js\";\nimport { u as useComponentPresetProp } from \"../../composables/useComponentPreset.js\";\nimport { u as useTranslation } from \"../../composables/useTranslation.js\";\nimport { V as VaFileUploadKey } from \"./types.js\";\nimport { V as VaButton } from \"../va-button/index.js\";\nimport { V as VaModal } from \"../va-modal/VaModal.js\";\nimport { V as VaFileUploadList } from \"./VaFileUploadList/index.js\";\nimport { _ as _export_sfc } from \"../../../plugin-vue_export-helper.js\";\n\nvar VaFileUpload_vue_vue_type_style_index_0_lang = /* @__PURE__ */(() => ':root{--va-file-upload-position: relative;--va-file-upload-margin: .5rem 0;--va-file-upload-list-margin-top: 1rem;--va-file-upload-dropzone-border-radius: .375rem;--va-file-upload-dropzone-cursor: pointer;--va-file-upload-dropzone-text-padding-sm: 0 0 1rem;--va-file-upload-dropzone-field-padding: 1.5rem 2rem;--va-file-upload-dropzone-field-padding-sm: 1.5rem 1rem;--va-file-upload-dropzone-field-button-margin: 0;--va-file-upload-dropzone-field-button-z-index: 10;--va-file-upload-dropzone-field-text-pr: 10px;--va-file-upload-dropzone-list-padding: 0 2rem 1rem}.va-file-upload{position:var(--va-file-upload-position);font-family:var(--va-font-family);margin:var(--va-file-upload-margin)}.va-file-upload .va-file-upload-list{margin-top:var(--va-file-upload-list-margin-top)}.va-file-upload__field{overflow:hidden;display:flex;align-items:center;position:relative}.va-file-upload__field__button{margin:var(--va-file-upload-dropzone-field-button-margin);z-index:10}.va-file-upload__field__text{padding-right:var(--va-file-upload-dropzone-field-text-pr)}.va-file-upload__field__input{position:absolute;top:0;right:0;height:100%;width:100%;color:transparent;opacity:0;cursor:pointer}.va-file-upload__field__input::-webkit-file-upload-button{cursor:pointer}.va-file-upload--dropzone{background-color:var(--va-file-upload-dropzone-background-color);overflow:hidden;border-radius:var(--va-file-upload-dropzone-border-radius);cursor:var(--va-file-upload-dropzone-cursor)}.va-file-upload--dropzone .va-file-upload__field{justify-content:center;display:flex;align-items:center;padding:var(--va-file-upload-dropzone-field-padding);transition:height .2s;overflow:visible;flex-wrap:wrap}@media (max-width: 767.98px){.va-file-upload--dropzone .va-file-upload__field{flex-direction:column;padding:var(--va-file-upload-dropzone-field-padding-sm)}.va-file-upload--dropzone .va-file-upload__field__text{padding:var(--va-file-upload-dropzone-text-padding-sm);text-align:center}}.va-file-upload--dropzone .va-file-upload-list{padding:var(--va-file-upload-dropzone-list-padding);margin-top:0}.va-file-upload--disabled .va-file-upload__field__input{cursor:default}.va-file-upload--disabled .va-file-upload__field__input::-webkit-file-upload-button{cursor:inherit}.va-file-upload .va-button:focus-visible{outline:2px solid var(--va-focus)!important;border-radius:\"inherit\";outline-offset:-2px}\\n')();\n\nconst _sfc_main = defineComponent({\n  name: \"VaFileUpload\",\n  components: {\n    VaModal,\n    VaButton,\n    VaFileUploadList\n  },\n  props: { ...useComponentPresetProp,\n    fileTypes: {\n      type: String,\n      default: \"\"\n    },\n    dropzone: {\n      type: Boolean,\n      default: false\n    },\n    hideFileList: {\n      type: Boolean,\n      default: false\n    },\n    color: {\n      type: String,\n      default: \"primary\"\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    undo: {\n      type: Boolean,\n      default: false\n    },\n    undoDuration: {\n      type: Number,\n      default: 3e3\n    },\n    undoButtonText: {\n      type: String,\n      default: \"$t:undo\"\n    },\n    dropZoneText: {\n      type: String,\n      default: \"$t:dropzone\"\n    },\n    uploadButtonText: {\n      type: String,\n      default: \"$t:uploadFile\"\n    },\n    deletedFileMessage: {\n      type: String,\n      default: \"$t:fileDeleted\"\n    },\n    modelValue: {\n      type: [Object, Array],\n      default: () => []\n    },\n    type: {\n      type: String,\n      default: \"list\",\n      validator: value => [\"list\", \"gallery\", \"single\"].includes(value)\n    }\n  },\n  emits: [\"update:modelValue\", \"file-removed\", \"file-added\"],\n\n  setup(props, {\n    emit\n  }) {\n    const fileInputRef = shallowRef();\n    const modal = ref(false);\n    const dropzoneHighlight = ref(false);\n    const {\n      getColor,\n      shiftHSLAColor\n    } = useColors();\n    const colorComputed = computed(() => getColor(props.color));\n    const computedStyle = computed(() => ({\n      backgroundColor: props.dropzone ? shiftHSLAColor(colorComputed.value, {\n        a: dropzoneHighlight.value ? -0.82 : -0.92\n      }) : \"transparent\"\n    }));\n    const computedClasses = useBem(\"va-file-upload\", () => ({\n      dropzone: props.dropzone,\n      disabled: props.disabled\n    }));\n    const files = computed({\n      get() {\n        return Array.isArray(props.modelValue) ? props.modelValue : [props.modelValue];\n      },\n\n      set(files2) {\n        if (props.type === \"single\") {\n          emit(\"update:modelValue\", files2[0]);\n        } else {\n          emit(\"update:modelValue\", files2);\n        }\n      }\n\n    });\n\n    const validateFiles = files2 => files2.filter(file => {\n      const fileName = file.name || file.url;\n\n      if (!fileName) {\n        return false;\n      }\n\n      if (file.url) {\n        return true;\n      }\n\n      const MIMETypes = [\"audio/*\", \"video/*\", \"image/*\"];\n      const isContainedMIMEType = MIMETypes.find(t => props.fileTypes.includes(t));\n\n      if (isContainedMIMEType) {\n        return true;\n      }\n\n      const extension = fileName.substring(fileName.lastIndexOf(\".\") + 1).toLowerCase();\n      const isCorrectExt = props.fileTypes.includes(extension);\n\n      if (!isCorrectExt) {\n        modal.value = true;\n      }\n\n      return isCorrectExt;\n    });\n\n    const uploadFile = e => {\n      var _a, _b;\n\n      const f = ((_a = e.target) == null ? void 0 : _a.files) || ((_b = e.dataTransfer) == null ? void 0 : _b.files);\n\n      if (!f) {\n        return;\n      }\n\n      const validatedFiles = props.fileTypes ? validateFiles(Array.from(f)) : f;\n      files.value = props.type === \"single\" ? validatedFiles : [...files.value, ...validatedFiles];\n      emit(\"file-added\", validatedFiles);\n    };\n\n    const changeFieldValue = e => {\n      uploadFile(e);\n\n      if (fileInputRef.value) {\n        fileInputRef.value.value = \"\";\n      }\n    };\n\n    const removeFile = index => {\n      if (index in files.value) {\n        const removedFile = files.value[index];\n        files.value = files.value.filter((item, idx) => idx !== index);\n        emit(\"file-removed\", removedFile);\n      }\n    };\n\n    const removeSingleFile = () => {\n      if (files.value.length > 0) {\n        const removedFile = files.value[0];\n        files.value = [];\n        emit(\"file-removed\", removedFile);\n      }\n    };\n\n    const callFileDialogue = () => {\n      if (fileInputRef.value) {\n        fileInputRef.value.click();\n      }\n    };\n\n    onMounted(() => {\n      if (Array.isArray(files.value)) {\n        files.value = validateFiles(files.value);\n      }\n    });\n    const {\n      tp\n    } = useTranslation();\n    provide(VaFileUploadKey, {\n      undo: toRef(props, \"undo\"),\n      disabled: toRef(props, \"disabled\"),\n      undoDuration: toRef(props, \"undoDuration\"),\n      undoButtonText: computed(() => tp(props.undoButtonText)),\n      deletedFileMessage: computed(() => tp(props.deletedFileMessage))\n    });\n    return {\n      modal,\n      dropzoneHighlight,\n      fileInputRef,\n      colorComputed,\n      computedStyle,\n      computedClasses,\n      files,\n      tp,\n      uploadFile,\n      changeFieldValue,\n      removeFile,\n      removeSingleFile,\n      callFileDialogue\n    };\n  }\n\n});\n\nconst _hoisted_1 = {\n  class: \"va-file-upload__field\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"va-file-upload__field__text\"\n};\nconst _hoisted_3 = [\"accept\", \"multiple\", \"disabled\"];\n\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_va_button = resolveComponent(\"va-button\");\n\n  const _component_va_file_upload_list = resolveComponent(\"va-file-upload-list\");\n\n  const _component_va_modal = resolveComponent(\"va-modal\");\n\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass([\"va-file-upload\", _ctx.computedClasses]),\n    style: normalizeStyle(_ctx.computedStyle)\n  }, [renderSlot(_ctx.$slots, \"default\", {}, () => [createElementVNode(\"div\", _hoisted_1, [_ctx.dropzone ? (openBlock(), createElementBlock(\"div\", _hoisted_2, toDisplayString(_ctx.tp(_ctx.dropZoneText)), 1)) : createCommentVNode(\"\", true), createVNode(_component_va_button, {\n    class: \"va-file-upload__field__button\",\n    disabled: _ctx.disabled,\n    \"aria-disabled\": _ctx.disabled,\n    color: _ctx.colorComputed,\n    style: normalizeStyle({\n      \"pointer-events\": _ctx.dropzoneHighlight ? \"none\" : void 0\n    }),\n    onChange: _ctx.changeFieldValue,\n    onClick: _ctx.callFileDialogue\n  }, {\n    default: withCtx(() => [createTextVNode(toDisplayString(_ctx.tp(_ctx.uploadButtonText)), 1)]),\n    _: 1\n  }, 8, [\"disabled\", \"aria-disabled\", \"color\", \"style\", \"onChange\", \"onClick\"])])]), createElementVNode(\"input\", {\n    ref: \"fileInputRef\",\n    type: \"file\",\n    class: \"va-file-upload__field__input\",\n    tabindex: -1,\n    \"aria-hidden\": \"true\",\n    accept: _ctx.fileTypes,\n    multiple: _ctx.type !== \"single\",\n    disabled: _ctx.disabled,\n    onChange: _cache[0] || (_cache[0] = (...args) => _ctx.changeFieldValue && _ctx.changeFieldValue(...args)),\n    onDragenter: _cache[1] || (_cache[1] = $event => _ctx.dropzoneHighlight = true),\n    onDragleave: _cache[2] || (_cache[2] = $event => _ctx.dropzoneHighlight = false)\n  }, null, 40, _hoisted_3), _ctx.files.length && !_ctx.$props.hideFileList ? (openBlock(), createBlock(_component_va_file_upload_list, {\n    key: 0,\n    type: _ctx.type,\n    files: _ctx.files,\n    color: _ctx.colorComputed,\n    onRemove: _ctx.removeFile,\n    onRemoveSingle: _ctx.removeSingleFile\n  }, null, 8, [\"type\", \"files\", \"color\", \"onRemove\", \"onRemoveSingle\"])) : createCommentVNode(\"\", true), createVNode(_component_va_modal, {\n    modelValue: _ctx.modal,\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => _ctx.modal = $event),\n    \"hide-default-actions\": \"\",\n    title: \"File validation\",\n    message: \"File type is incorrect!\"\n  }, null, 8, [\"modelValue\"])], 6);\n}\n\nvar _VaFileUpload = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\n\nexport { _VaFileUpload as _ };\nimport './VaFileUpload.css';","map":{"version":3,"mappings":"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","names":["_sfc_main","defineComponent","name","components","VaModal","VaButton","VaFileUploadList","props","useComponentPresetProp","fileTypes","type","String","default","dropzone","Boolean","hideFileList","color","disabled","undo","undoDuration","Number","undoButtonText","dropZoneText","uploadButtonText","deletedFileMessage","modelValue","Object","Array","validator","value","includes","emits","setup","emit","fileInputRef","shallowRef","ref","getColor","shiftHSLAColor","useColors","colorComputed","computed","backgroundColor","a","dropzoneHighlight","useBem","files","get","isArray","set","files2","validateFiles","filter","file","url","fileName","MIMETypes","find","t","isContainedMIMEType","substring","lastIndexOf","toLowerCase","isCorrectExt","extension","modal","e","f","target","dataTransfer","from","validatedFiles","uploadFile","index","item","idx","removedFile","removeSingleFile","length","callFileDialogue","click","onMounted","tp","useTranslation","provide","VaFileUploadKey","toRef","computedStyle","computedClasses","changeFieldValue","removeFile","class","_createElementBlock","_normalizeClass","_ctx","style","_normalizeStyle","_renderSlot","_createElementVNode","_toDisplayString","_createCommentVNode","_createVNode","_component_va_button","onChange","onClick","_createTextVNode","_","tabindex","accept","multiple","_cache","onDragenter","onDragleave","_hoisted_3","$props","_openBlock","_createBlock","_component_va_file_upload_list","key","onRemove","onRemoveSingle","_component_va_modal","title","message"],"sources":["../../../../../src/components/va-file-upload/VaFileUpload.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-file-upload\"\n    :class=\"computedClasses\"\n    :style=\"computedStyle\"\n  >\n    <slot>\n      <div class=\"va-file-upload__field\">\n        <div\n          v-if=\"dropzone\"\n          class=\"va-file-upload__field__text\"\n        >\n          {{ tp(dropZoneText) }}\n        </div>\n        <va-button\n          class=\"va-file-upload__field__button\"\n          :disabled=\"disabled\"\n          :aria-disabled=\"disabled\"\n          :color=\"colorComputed\"\n          :style=\"{ 'pointer-events': dropzoneHighlight ? 'none' : undefined }\"\n          @change=\"changeFieldValue\"\n          @click=\"callFileDialogue\"\n        >\n          {{ tp(uploadButtonText) }}\n        </va-button>\n      </div>\n    </slot>\n\n    <input\n      ref=\"fileInputRef\"\n      type=\"file\"\n      class=\"va-file-upload__field__input\"\n      :tabindex=\"-1\"\n      aria-hidden=\"true\"\n      :accept=\"fileTypes\"\n      :multiple=\"type !== 'single'\"\n      :disabled=\"disabled\"\n      @change=\"changeFieldValue\"\n      @dragenter=\"dropzoneHighlight = true\"\n      @dragleave=\"dropzoneHighlight = false\"\n    >\n    <va-file-upload-list\n      v-if=\"files.length && !$props.hideFileList\"\n      :type=\"type\"\n      :files=\"files\"\n      :color=\"colorComputed\"\n      @remove=\"removeFile\"\n      @removeSingle=\"removeSingleFile\"\n    />\n    <va-modal\n      v-model=\"modal\"\n      hide-default-actions\n      title=\"File validation\"\n      message=\"File type is incorrect!\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, ref, toRef, shallowRef, provide, PropType } from 'vue'\n\nimport { useColors, useComponentPresetProp, useBem, useTranslation } from '../../composables'\n\nimport { VaFileUploadKey, VaFile } from './types'\n\nimport { VaButton, VaModal } from '../index'\nimport { VaFileUploadList } from './VaFileUploadList'\n\nexport default defineComponent({\n  name: 'VaFileUpload',\n\n  components: {\n    VaModal,\n    VaButton,\n    VaFileUploadList,\n  },\n\n  props: {\n    ...useComponentPresetProp,\n    fileTypes: { type: String, default: '' },\n    dropzone: { type: Boolean, default: false },\n    hideFileList: { type: Boolean, default: false },\n    color: { type: String, default: 'primary' },\n    disabled: { type: Boolean, default: false },\n    undo: { type: Boolean, default: false },\n    undoDuration: { type: Number, default: 3000 },\n    undoButtonText: { type: String, default: '$t:undo' },\n    dropZoneText: { type: String, default: '$t:dropzone' },\n    uploadButtonText: { type: String, default: '$t:uploadFile' },\n    deletedFileMessage: { type: String, default: '$t:fileDeleted' },\n    modelValue: {\n      type: [Object, Array] as PropType<VaFile | VaFile[]>,\n      default: () => [],\n    },\n    type: {\n      type: String as PropType<'list' | 'gallery' | 'single'>,\n      default: 'list',\n      validator: (value: string) => ['list', 'gallery', 'single'].includes(value),\n    },\n  },\n\n  emits: ['update:modelValue', 'file-removed', 'file-added'],\n\n  setup (props, { emit }) {\n    const fileInputRef = shallowRef<HTMLInputElement>()\n\n    const modal = ref(false)\n    const dropzoneHighlight = ref(false)\n\n    const { getColor, shiftHSLAColor } = useColors()\n    const colorComputed = computed(() => getColor(props.color))\n\n    const computedStyle = computed(() => ({\n      backgroundColor: props.dropzone\n        ? shiftHSLAColor(colorComputed.value, { a: dropzoneHighlight.value ? -0.82 : -0.92 })\n        : 'transparent',\n    }))\n\n    const computedClasses = useBem('va-file-upload', () => ({\n      dropzone: props.dropzone,\n      disabled: props.disabled,\n    }))\n\n    const files = computed<VaFile[]>({\n      get () { return Array.isArray(props.modelValue) ? props.modelValue : [props.modelValue] },\n      set (files) {\n        if (props.type === 'single') {\n          emit('update:modelValue', files[0])\n        } else {\n          emit('update:modelValue', files)\n        }\n      },\n    })\n\n    const validateFiles = (files: VaFile[]) => files.filter((file) => {\n      const fileName = file.name || file.url\n      if (!fileName) { return false }\n      if (file.url) { return true }\n\n      const MIMETypes = ['audio/*', 'video/*', 'image/*']\n      const isContainedMIMEType = MIMETypes.find((t) => props.fileTypes.includes(t))\n\n      if (isContainedMIMEType) {\n        // Do not validate MIMEType because there is too much to validate.\n        return true\n      }\n\n      const extension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase()\n\n      const isCorrectExt = props.fileTypes.includes(extension)\n      if (!isCorrectExt) { modal.value = true }\n\n      return isCorrectExt\n    })\n\n    const uploadFile = (e: Event | DragEvent) => {\n      const f = (e.target as HTMLInputElement)?.files || (e as DragEvent).dataTransfer?.files\n\n      if (!f) { return }\n\n      const validatedFiles = props.fileTypes ? validateFiles(Array.from(f)) : f\n\n      files.value = props.type === 'single' ? (validatedFiles as VaFile[]) : [...files.value, ...validatedFiles]\n\n      emit('file-added', validatedFiles)\n    }\n\n    const changeFieldValue = (e: Event | DragEvent) => {\n      uploadFile(e)\n\n      if (fileInputRef.value) {\n        fileInputRef.value.value = ''\n      }\n    }\n\n    const removeFile = (index: number) => {\n      if (index in files.value) {\n        const removedFile = files.value[index]\n        files.value = files.value.filter((item, idx) => idx !== index)\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const removeSingleFile = () => {\n      if (files.value.length > 0) {\n        const removedFile = files.value[0]\n        files.value = []\n        emit('file-removed', removedFile)\n      }\n    }\n\n    const callFileDialogue = () => {\n      if (fileInputRef.value) {\n        fileInputRef.value.click()\n      }\n    }\n\n    onMounted(() => {\n      if (Array.isArray(files.value)) {\n        files.value = validateFiles(files.value)\n      }\n    })\n\n    const { tp } = useTranslation()\n\n    provide(VaFileUploadKey, {\n      undo: toRef(props, 'undo'),\n      disabled: toRef(props, 'disabled'),\n      undoDuration: toRef(props, 'undoDuration'),\n      undoButtonText: computed(() => tp(props.undoButtonText)),\n      deletedFileMessage: computed(() => tp(props.deletedFileMessage)),\n    })\n\n    return {\n      modal,\n      dropzoneHighlight,\n      fileInputRef,\n      colorComputed,\n      computedStyle,\n      computedClasses,\n      files,\n      tp,\n      uploadFile,\n      changeFieldValue,\n      removeFile,\n      removeSingleFile,\n      callFileDialogue,\n    }\n  },\n})\n</script>\n\n<style lang='scss'>\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-file-upload {\n  position: var(--va-file-upload-position);\n  font-family: var(--va-font-family);\n  margin: var(--va-file-upload-margin);\n\n  .va-file-upload-list {\n    margin-top: var(--va-file-upload-list-margin-top);\n  }\n\n  &__field {\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    position: relative;\n\n    &__button {\n      margin: var(--va-file-upload-dropzone-field-button-margin);\n      z-index: 10;\n    }\n\n    &__text {\n      padding-right: var(--va-file-upload-dropzone-field-text-pr);\n    }\n\n    &__input {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n      color: transparent;\n      opacity: 0;\n      cursor: pointer;\n\n      &::-webkit-file-upload-button {\n        cursor: pointer;\n      }\n    }\n  }\n\n  &--dropzone {\n    background-color: var(--va-file-upload-dropzone-background-color);\n    overflow: hidden;\n    border-radius: var(--va-file-upload-dropzone-border-radius);\n    cursor: var(--va-file-upload-dropzone-cursor);\n\n    .va-file-upload__field {\n      justify-content: center;\n      display: flex;\n      align-items: center;\n      padding: var(--va-file-upload-dropzone-field-padding);\n      transition: height 0.2s;\n      overflow: visible;\n      flex-wrap: wrap;\n\n      @include media-breakpoint-down(sm) {\n        flex-direction: column;\n        padding: var(--va-file-upload-dropzone-field-padding-sm);\n\n        &__text {\n          padding: var(--va-file-upload-dropzone-text-padding-sm);\n          text-align: center;\n        }\n      }\n    }\n\n    .va-file-upload-list {\n      padding: var(--va-file-upload-dropzone-list-padding);\n      margin-top: 0;\n    }\n  }\n\n  &--disabled {\n    .va-file-upload__field__input {\n      cursor: default;\n\n      &::-webkit-file-upload-button {\n        cursor: inherit;\n      }\n    }\n  }\n\n  .va-button {\n    @include keyboard-focus-outline($offset: -2px);\n  }\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}