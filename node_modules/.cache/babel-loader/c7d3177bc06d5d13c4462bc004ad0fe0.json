{"ast":null,"code":"import { defineComponent, ref, computed, watch, openBlock, createElementBlock, normalizeClass, normalizeStyle, renderSlot, normalizeProps, guardReactiveProps, createElementVNode, Fragment, renderList, mergeProps } from \"vue\";\nimport { p as pick_1 } from \"../../../vendor.js\";\nimport { u as useBem } from \"../../composables/useBem.js\";\nimport { u as useEvent } from \"../../composables/useEvent.js\";\nimport { u as useTrackByProps, a as useTrackBy } from \"../../composables/useTrackBy.js\";\nimport { u as useVirtualScrollerSizesProps, a as useVirtualScrollerSizes } from \"./useVirtualScrollerSizes.js\";\nimport { _ as _export_sfc } from \"../../../plugin-vue_export-helper.js\";\n\nvar VaVirtualScroller_vue_vue_type_style_index_0_lang = /* @__PURE__ */(() => \".va-virtual-scroller{overflow:auto}.va-virtual-scroller__container{position:relative;overflow:hidden}.va-virtual-scroller__list{display:flex;flex-direction:column}.va-virtual-scroller--horizontal .va-virtual-scroller__list{flex-direction:row}\\n\")();\n\nconst _sfc_main = defineComponent({\n  name: \"VaVirtualScroller\",\n  props: { ...useTrackByProps,\n    ...useVirtualScrollerSizesProps,\n    items: {\n      type: Array,\n      default: () => []\n    },\n    bench: {\n      type: Number,\n      default: 10,\n      validator: v => v >= 0\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    table: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: [\"scroll:bottom\"],\n  setup: (props, {\n    emit\n  }) => {\n    const listScrollPosition = ref(0);\n    const scrollDirection = computed(() => props.horizontal ? \"scrollLeft\" : \"scrollTop\");\n\n    const handleScroll = () => {\n      if (!wrapper.value) {\n        return;\n      }\n\n      listScrollPosition.value = wrapper.value[scrollDirection.value];\n    };\n\n    if (!props.disabled) {\n      useEvent(\"scroll\", handleScroll, true);\n    }\n\n    const {\n      list,\n      wrapper,\n      itemSize,\n      wrapperSize\n    } = useVirtualScrollerSizes(props, listScrollPosition);\n    const {\n      getKey\n    } = useTrackBy(props);\n\n    const uniqueKey = (item, index, defaultValue) => getKey(item, index, defaultValue);\n\n    watch(listScrollPosition, newValue => {\n      if (newValue + wrapperSize.value === containerSize.value) {\n        emit(\"scroll:bottom\");\n      }\n    });\n    const renderStartIndex = computed(() => {\n      return Math.max(0, Math.floor(listScrollPosition.value / itemSize.value) - props.bench);\n    });\n    const renderItemsAmount = computed(() => {\n      var _a;\n\n      if (!((_a = props.items) == null ? void 0 : _a.length)) {\n        return 0;\n      }\n\n      return props.disabled ? props.items.length : Math.min(props.items.length - renderStartIndex.value, Math.ceil(wrapperSize.value / itemSize.value) + props.bench * 2);\n    });\n    const renderEndIndex = computed(() => renderStartIndex.value + renderItemsAmount.value);\n    const renderBuffer = computed(() => {\n      var _a;\n\n      if (!((_a = props.items) == null ? void 0 : _a.length)) {\n        return [];\n      }\n\n      return props.items.slice(renderStartIndex.value, renderEndIndex.value);\n    });\n    const sizeAttribute = computed(() => props.horizontal ? \"width\" : \"height\");\n    const isDisabledVirtualTable = computed(() => props.table && props.disabled);\n    const wrapperStyleComputed = computed(() => ({\n      [sizeAttribute.value]: isDisabledVirtualTable.value ? void 0 : `${wrapperSize.value}px`\n    }));\n    const wrapperClassComputed = useBem(\"va-virtual-scroller\", () => ({ ...pick_1(props, [\"horizontal\"])\n    }));\n    const containerSize = computed(() => {\n      var _a, _b;\n\n      return ((_b = (_a = props.items) == null ? void 0 : _a.length) != null ? _b : 0) * itemSize.value;\n    });\n    const containerStyleComputed = computed(() => ({\n      [sizeAttribute.value]: isDisabledVirtualTable.value ? void 0 : `${containerSize.value}px`\n    }));\n    const currentListOffset = computed(() => renderStartIndex.value * itemSize.value);\n    const listStyleComputed = computed(() => ({\n      transform: `translate${props.horizontal ? \"X\" : \"Y\"}(${currentListOffset.value}px)`\n    }));\n    const scrollToAttribute = computed(() => props.horizontal ? \"left\" : \"top\");\n\n    const virtualScrollTo = index => {\n      var _a;\n\n      if (!index && index !== 0) {\n        return;\n      }\n\n      (_a = wrapper.value) == null ? void 0 : _a.scrollTo({\n        [scrollToAttribute.value]: index * itemSize.value\n      });\n    };\n\n    return {\n      containerStyleComputed,\n      wrapperStyleComputed,\n      wrapperClassComputed,\n      listStyleComputed,\n      currentListOffset,\n      renderStartIndex,\n      virtualScrollTo,\n      renderBuffer,\n      uniqueKey,\n      wrapper,\n      list\n    };\n  }\n});\n\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createElementBlock(\"div\", {\n    ref: \"wrapper\",\n    class: normalizeClass([\"va-virtual-scroller\", _ctx.wrapperClassComputed]),\n    style: normalizeStyle(_ctx.wrapperStyleComputed)\n  }, [renderSlot(_ctx.$slots, \"content\", normalizeProps(guardReactiveProps({\n    containerStyleComputed: _ctx.containerStyleComputed,\n    listStyleComputed: _ctx.listStyleComputed,\n    renderBuffer: _ctx.renderBuffer,\n    uniqueKey: _ctx.uniqueKey,\n    currentListOffset: _ctx.currentListOffset\n  })), () => [createElementVNode(\"div\", {\n    class: \"va-virtual-scroller__container\",\n    style: normalizeStyle(_ctx.containerStyleComputed)\n  }, [createElementVNode(\"div\", {\n    ref: \"list\",\n    role: \"list\",\n    class: \"va-virtual-scroller__list\",\n    style: normalizeStyle(_ctx.listStyleComputed)\n  }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.renderBuffer, (item, index) => {\n    return renderSlot(_ctx.$slots, \"default\", normalizeProps(mergeProps({\n      key: _ctx.uniqueKey(item, index)\n    }, {\n      item,\n      index: _ctx.renderStartIndex + index\n    })));\n  }), 128))], 4)], 4)])], 6);\n}\n\nvar _VaVirtualScroller = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\n\nexport { _VaVirtualScroller as _ };\nimport './VaVirtualScroller.css';","map":{"version":3,"mappings":"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","names":["_sfc_main","defineComponent","name","props","useTrackByProps","useVirtualScrollerSizesProps","items","type","Array","default","bench","Number","validator","v","disabled","Boolean","table","emits","setup","emit","ref","scrollDirection","computed","horizontal","handleScroll","wrapper","value","listScrollPosition","useEvent","list","itemSize","wrapperSize","useVirtualScrollerSizes","getKey","useTrackBy","item","index","defaultValue","watch","newValue","containerSize","max","Math","floor","length","min","renderStartIndex","ceil","renderEndIndex","renderItemsAmount","slice","sizeAttribute","isDisabledVirtualTable","useBem","pick","currentListOffset","transform","scrollToAttribute","scrollTo","containerStyleComputed","wrapperStyleComputed","wrapperClassComputed","listStyleComputed","virtualScrollTo","renderBuffer","uniqueKey","_createElementBlock","class","_normalizeClass","_ctx","style","_normalizeStyle","_renderSlot","_normalizeProps","_createElementVNode","role","_openBlock","_Fragment","_renderList","key","_mergeProps"],"sources":["../../../../../src/components/va-virtual-scroller/VaVirtualScroller.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"wrapper\"\n    class=\"va-virtual-scroller\"\n    :style=\"wrapperStyleComputed\"\n    :class=\"wrapperClassComputed\"\n  >\n    <slot\n      name=\"content\"\n      v-bind=\"{ containerStyleComputed, listStyleComputed, renderBuffer, uniqueKey, currentListOffset }\"\n    >\n      <div\n        class=\"va-virtual-scroller__container\"\n        :style=\"containerStyleComputed\"\n      >\n        <div\n          ref=\"list\"\n          role=\"list\"\n          class=\"va-virtual-scroller__list\"\n          :style=\"listStyleComputed\"\n        >\n          <template\n            v-for=\"(item, index) in renderBuffer\"\n            :key=\"uniqueKey(item, index)\"\n          >\n            <slot name=\"default\" v-bind=\"{ item, index: renderStartIndex + index }\" />\n          </template>\n        </div>\n      </div>\n    </slot>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, computed, watch } from 'vue'\nimport pick from 'lodash/pick.js'\n\nimport { useEvent, useBem, useTrackBy, useTrackByProps } from '../../composables'\nimport { useVirtualScrollerSizes, useVirtualScrollerSizesProps } from './useVirtualScrollerSizes'\n\nexport default defineComponent({\n  name: 'VaVirtualScroller',\n\n  props: {\n    ...useTrackByProps,\n    ...useVirtualScrollerSizesProps,\n    items: { type: Array, default: () => ([]) },\n    bench: { type: Number, default: 10, validator: (v: number) => v >= 0 },\n    disabled: { type: Boolean, default: false },\n    table: { type: Boolean, default: false },\n  },\n\n  emits: ['scroll:bottom'],\n\n  setup: (props, { emit }) => {\n    const listScrollPosition = ref(0)\n    const scrollDirection = computed(() => props.horizontal ? 'scrollLeft' : 'scrollTop')\n    const handleScroll = () => {\n      if (!wrapper.value) { return }\n      listScrollPosition.value = wrapper.value[scrollDirection.value]\n    }\n    if (!props.disabled) { useEvent('scroll', handleScroll, true) }\n\n    const { list, wrapper, itemSize, wrapperSize } = useVirtualScrollerSizes(props, listScrollPosition)\n\n    const { getKey } = useTrackBy(props)\n    const uniqueKey = (item: Array<any> | Record<string, any>, index: number, defaultValue?: any) => getKey(item, index, defaultValue)\n\n    watch(listScrollPosition, (newValue) => {\n      if (newValue + wrapperSize.value === containerSize.value) {\n        emit('scroll:bottom')\n      }\n    })\n\n    // forming items to render\n    const renderStartIndex = computed(() => {\n      return Math.max(0, Math.floor(listScrollPosition.value / itemSize.value) - props.bench)\n    })\n    const renderItemsAmount = computed(() => {\n      if (!props.items?.length) { return 0 }\n      return props.disabled\n        ? props.items.length\n        : Math.min(props.items.length - renderStartIndex.value, Math.ceil(wrapperSize.value / itemSize.value) + props.bench * 2)\n    })\n    const renderEndIndex = computed(() => renderStartIndex.value + renderItemsAmount.value)\n    const renderBuffer = computed(() => {\n      if (!props.items?.length) { return [] }\n      return props.items.slice(renderStartIndex.value, renderEndIndex.value)\n    })\n\n    const sizeAttribute = computed(() => props.horizontal ? 'width' : 'height')\n\n    // wrapper styles and classes\n    const isDisabledVirtualTable = computed(() => props.table && props.disabled)\n\n    const wrapperStyleComputed = computed(() => ({\n      [sizeAttribute.value]: isDisabledVirtualTable.value ? undefined : `${wrapperSize.value}px`,\n    }))\n    const wrapperClassComputed = useBem('va-virtual-scroller', () => ({\n      ...pick(props, ['horizontal']),\n    }))\n\n    // container styles\n    const containerSize = computed(() => (props.items?.length ?? 0) * itemSize.value)\n    const containerStyleComputed = computed(() => ({\n      [sizeAttribute.value]: isDisabledVirtualTable.value ? undefined : `${containerSize.value}px`,\n    }))\n\n    // items list styles\n    const currentListOffset = computed(() => renderStartIndex.value * itemSize.value)\n    const listStyleComputed = computed(() => ({\n      transform: `translate${props.horizontal ? 'X' : 'Y'}(${currentListOffset.value}px)`,\n    }))\n\n    // public\n    const scrollToAttribute = computed(() => props.horizontal ? 'left' : 'top')\n    const virtualScrollTo = (index: number) => {\n      if (!index && index !== 0) { return }\n\n      wrapper.value?.scrollTo({ [scrollToAttribute.value]: index * itemSize.value })\n    }\n\n    return {\n      containerStyleComputed,\n      wrapperStyleComputed,\n      wrapperClassComputed,\n      listStyleComputed,\n      currentListOffset,\n      renderStartIndex,\n      virtualScrollTo,\n      renderBuffer,\n      uniqueKey,\n      wrapper,\n      list,\n    }\n  },\n})\n</script>\n\n<style lang=\"scss\">\n.va-virtual-scroller {\n  overflow: auto;\n\n  &__container {\n    position: relative;\n    overflow: hidden;\n  }\n\n  &__list {\n    display: flex;\n    flex-direction: column;\n  }\n\n  &--horizontal {\n    & .va-virtual-scroller__list {\n      flex-direction: row;\n    }\n  }\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}