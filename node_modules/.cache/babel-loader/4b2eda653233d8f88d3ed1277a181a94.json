{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { Bar } from \"vue-chartjs\";\nimport { Chart as ChartJS, Title, ArcElement, Tooltip, Legend, BarElement, CategoryScale, LinearScale, LineElement, PointElement } from \"chart.js\";\nimport { Doughnut } from \"vue-chartjs\";\nimport { Line as LineChartGenerator } from \"vue-chartjs\";\nChartJS.register(Title, ArcElement, Tooltip, Legend, BarElement, CategoryScale, LinearScale, LineElement, PointElement);\nimport axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\nexport default {\n  name: \"ListarEstadisticas\",\n  components: {\n    Bar,\n    Doughnut,\n    LineChartGenerator // modalPrestamo,\n    // Loading\n    // CrearLibro,\n    // Carousel,\n    // Slide\n\n  },\n  props: {\n    chartId: {\n      type: String,\n      default: \"line-chart\"\n    },\n    datasetIdKey: {\n      type: String,\n      default: \"label\"\n    },\n    width: {\n      type: Number,\n      default: 400\n    },\n    height: {\n      type: Number,\n      default: 400\n    },\n    cssClasses: {\n      default: \"\",\n      type: String\n    },\n    styles: {\n      type: Object,\n      default: () => {}\n    },\n    plugins: {\n      type: Array,\n      default: () => []\n    }\n  },\n\n  data() {\n    return {\n      fechaInicio: \"\",\n      fechaFin: \"\",\n      estado: -1,\n      solicitudes: [],\n      materiales: [],\n      preTitulo: {},\n      solicitudesFiltradas: [],\n      NombreSolicitate: [],\n      busquedaCodigo: \"\",\n      subsede: localStorage.getItem(\"idSubsede\"),\n      acceso: localStorage.getItem(\"acceso\"),\n      chartDataL: {\n        labels: [],\n        datasets: [{\n          backgroundColor: [\"#41B883\", \"#E46651\", \"#00D8FF\", \"#DD1B16\", \"#E412351\", \"#45D8FF\", \"#aa1B16\"],\n          data: []\n        }]\n      },\n      chartDataP: {\n        labels: [],\n        datasets: [{\n          backgroundColor: [\"#41B883\", \"#E46651\", \"#00D8FF\", \"#DD1B16\", \"#E412351\", \"#45D8FF\", \"#aa1B16\"],\n          data: []\n        }]\n      },\n      totalesM: 0,\n      totalesD: 0,\n      dataBar: {\n        labels: [],\n        datasets: [{\n          backgroundColor: \"#33C4FF\",\n          label: [],\n          data: []\n        }, {\n          backgroundColor: \"#54FF7E\",\n          label: [],\n          data: []\n        }]\n      },\n      chartOptions: {\n        maintainAspectRatio: true,\n        responsive: true,\n        plugins: {\n          chartAreaBorder: {\n            borderColor: \"red\",\n            borderWidth: 2,\n            borderDash: [5, 5],\n            borderDashOffset: 2\n          }\n        }\n      },\n      chartOptionsBar: {\n        indexAxis: \"y\",\n        maintainAspectRatio: true,\n        responsive: true\n      },\n      //////\n      // Almacenar las solicitudes aceptadas por mes\n      solicitudesAceptadasPorMes: [],\n      // Almacenar las solicitudes rechazadas por mes\n      solicitudesRechazadasPorMes: [],\n      chartDataMeses: {\n        labels: [\"Enero\", \"Febrero\", \"Marzo\", \"Abril\", \"Mayo\", \"Junio\", \"Julio\", \"Agosto\", \"Septiembre\", \"Octubre\", \"Noviembre\", \"Diciembre\"],\n        datasets: [{\n          label: \"Solicitudes aceptadas\",\n          backgroundColor: \"rgba(75, 192, 192, 0.6)\",\n          // Cambia el color de fondo\n          borderColor: \"rgba(75, 192, 192, 1)\",\n          // Cambia el color de la línea\n          borderWidth: 1,\n          // Ancho de la línea\n          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n        }, {\n          label: \"Solicitudes Rechazadas\",\n          backgroundColor: \"rgba(255, 0, 0, 0.6)\",\n          // Cambia el color de fondo\n          borderColor: \"rgba(255, 0, 0, 1)\",\n          // Cambia el color de la línea\n          borderWidth: 1,\n          // Ancho de la línea\n          data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n        }]\n      },\n      chartOptionsMeses: {\n        responsive: true,\n        maintainAspectRatio: false\n      }\n    };\n  },\n\n  beforeMount() {\n    this.obtenersolicitudes();\n  },\n\n  methods: {\n    obtenersolicitudes() {\n      fetch(RUTA_SERVIDOR_LIBROS + \"/prestamo/\" + localStorage.getItem(\"idSubsede\")).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        this.solicitudes = datosRespuesta.reverse();\n        const solicitudesAceptadas = datosRespuesta.filter(solicitud => solicitud.estado === 2 || solicitud.estado === 3 || solicitud.estado === 4 || solicitud.estado === 5);\n        const solicitudesRechazadas = datosRespuesta.filter(solicitud => solicitud.estado === 0 // Cambiar el estado al que corresponde a \"Solicitud rechazada\"\n        ); // Almacenar las solicitudes aceptadas y rechazadas en variables separadas\n\n        this.solicitudesAceptadas = solicitudesAceptadas;\n        this.solicitudesRechazadas = solicitudesRechazadas; // Agrupar las solicitudes por mes\n\n        this.solicitudesAceptadasPorMes = this.groupSolicitudesPorMes(solicitudesAceptadas);\n        this.solicitudesRechazadasPorMes = this.groupSolicitudesPorMes(solicitudesRechazadas);\n      }).then(() => {\n        const cantidadAceptadasPorMes = Object.values(this.solicitudesAceptadasPorMes).map(mes => mes.length);\n        this.chartDataMeses.datasets[0].data.map((data, index) => {\n          this.chartDataMeses.datasets[0].data[index] = cantidadAceptadasPorMes[index];\n        });\n        const cantidadRechazadaPorMes = Object.values(this.solicitudesRechazadasPorMes).map(mes => mes.length);\n        this.chartDataMeses.datasets[1].data.map((data, index) => {\n          this.chartDataMeses.datasets[1].data[index] = cantidadRechazadaPorMes[index];\n        });\n        console.log(this.chartDataMeses);\n\n        for (let index = 0; index < this.solicitudes.length; index++) {\n          this.asignarNombre(this.solicitudes[index].codigoUsuario, this.solicitudes[index].id);\n        }\n      }).catch(console.log);\n    },\n\n    groupSolicitudesPorMes(solicitudes) {\n      const solicitudesPorMes = {};\n      const yearActual = new Date().getFullYear(); // Inicializar el objeto con todas las fechas de los meses del año actual\n\n      for (let month = 0; month < 12; month++) {\n        const mesKey = `${yearActual}-${month + 1}`;\n        solicitudesPorMes[mesKey] = [];\n      }\n\n      solicitudes.forEach(solicitud => {\n        const fechaPrestamo = new Date(solicitud.fechaPrestamo);\n        const mes = fechaPrestamo.getMonth();\n        const year = fechaPrestamo.getFullYear();\n\n        if (year === yearActual) {\n          const mesKey = `${year}-${mes + 1}`;\n          solicitudesPorMes[mesKey].push(solicitud);\n        }\n      });\n      return solicitudesPorMes;\n    },\n\n    asignarNombre(codigoAlumnon, index) {\n      if (this.NombreSolicitate[index] == undefined) {\n        fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + codigoAlumnon).then(respuesta => respuesta.json()).then(datosRespuesta => {\n          this.filtrarSolicitudes();\n          this.NombreSolicitate[index] = datosRespuesta.nombre + \" \" + datosRespuesta.ap_paterno + \" \" + datosRespuesta.ap_materno;\n        });\n      } else {\n        return;\n      }\n    },\n\n    filtrarSolicitudes() {\n      // Filtrar por estado\n      let solicitudesFiltradas = this.solicitudes.filter(solicitud => {\n        return this.estado == -1 || solicitud.estado === parseInt(this.estado);\n      });\n      solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n        // Comprobar si el código de usuario o el título contiene la cadena de búsqueda\n        return solicitud.estado === 2 || solicitud.estado === 3 || solicitud.estado === 4 || solicitud.estado === 5;\n      });\n\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n          return solicitud.fechaPrestamo >= this.fechaInicio && solicitud.fechaPrestamo <= this.fechaFin;\n        });\n      } // Filtrar por fecha de préstamo si se proporcionan fechas válidas\n\n\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n          return solicitud.fechaPrestamo >= this.fechaInicio && solicitud.fechaPrestamo <= this.fechaFin;\n        });\n      } // Filtrar por código de usuario (coincidencia parcial)\n\n\n      if (this.busquedaCodigo !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n          // Comprobar si el código de usuario o el título contiene la cadena de búsqueda\n          return solicitud.codigoUsuario.includes(this.busquedaCodigo) || solicitud.titulo.includes(this.busquedaCodigo);\n        });\n      } else {// Si no hay cadena de búsqueda, mantener los filtros anteriores\n        // (no es necesario cambiar nada aquí)\n      } // El resto del código permanece igual\n\n\n      this.solicitudesFiltradas = solicitudesFiltradas;\n      this.consultarCantidad();\n    },\n\n    consultarCantidad() {\n      this.totalesM = 0;\n      const repetir = {};\n      const nombresUnicos = []; // Un arreglo para almacenar los nombres únicos\n\n      for (let i = 0; i < this.solicitudesFiltradas.length; i++) {\n        const obj = this.solicitudesFiltradas[i];\n        const nombre = obj.titulo;\n\n        if (repetir[nombre]) {\n          repetir[nombre]++;\n        } else {\n          repetir[nombre] = 1;\n          nombresUnicos.push(nombre); // Agregar el nombre único al arreglo\n        }\n\n        this.totalesM++;\n      }\n\n      this.chartDataL.datasets[0].data = [];\n      this.chartDataL.labels = [];\n      this.chartDataL.datasets[0].backgroundColor = [];\n      const coloresAleatorios = this.generarColoresAleatorios(nombresUnicos.length); // Limpia el array de labels antes de agregar el nuevo resultado\n\n      this.chartDataL.labels = nombresUnicos.map(nombre => `${nombre}: ${repetir[nombre]}`); // Almacena los nombres únicos\n\n      this.chartDataL.datasets[0].data = nombresUnicos.map(nombre => repetir[nombre]); // Almacena la cantidad de repeticiones para cada nombre\n\n      this.chartDataL.datasets[0].backgroundColor = coloresAleatorios;\n    },\n\n    generarColoresAleatorios(cantidad) {\n      const colores = [];\n\n      for (let i = 0; i < cantidad; i++) {\n        const r = Math.floor(Math.random() * 100) + 155; // Componente rojo en el rango de 155 a 255\n\n        const g = Math.floor(Math.random() * 100) + 155; // Componente verde en el rango de 155 a 255\n\n        const b = Math.floor(Math.random() * 100) + 155; // Componente azul en el rango de 155 a 255\n\n        const color = `rgb(${r},${g},${b})`;\n        colores.push(color);\n      }\n\n      return colores;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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CA;QACAf,0DACAE,IADA,CACAC,6BADA,EAEAD,IAFA,CAEAE;UACA;UACA,+BACAA,wBACA,GADA,GAEAA,yBAFA,GAGA,GAHA,GAIAA,yBALA;QAMA,CAVA;MAWA,CAZA,MAYA;QACA;MACA;IACA,CArGA;;IAuGAY;MACA;MACA;QACA;MACA,CAFA;MAGA/C;QACA;QACA,OACAoC,0BACAA,sBADA,IAEAA,sBAFA,IAGAA,sBAJA;MAMA,CARA;;MASA;QACApC;UACA,OACAoC,+CACAA,wCAFA;QAIA,CALA;MAMA,CArBA,CAsBA;;;MACA;QACApC;UACA,OACAoC,+CACAA,wCAFA;QAIA,CALA;MAMA,CA9BA,CAgCA;;;MACA;QACApC;UACA;UACA,OACAoC,yDACAA,8CAFA;QAIA,CANA;MAOA,CARA,MAQA,CACA;QACA;MACA,CA5CA,CA8CA;;;MACA;MAEA;IACA,CAzJA;;IA2JAY;MACA;MAEA;MACA,yBAJA,CAIA;;MAEA;QACA;QACA;;QAEA;UACAC;QACA,CAFA,MAEA;UACAA;UACAC,2BAFA,CAEA;QACA;;QACA;MACA;;MACA;MACA;MACA;MACA,wDACAA,oBADA,EArBA,CAyBA;;MACA,2CACAC,yCADA,EA1BA,CA4BA;;MACA,qDACAA,yBADA,EA7BA,CA+BA;;MAEA;IACA,CA7LA;;IA8LAC;MACA;;MACA;QACA,gDADA,CACA;;QACA,gDAFA,CAEA;;QACA,gDAHA,CAGA;;QAEA;QACAC;MACA;;MAEA;IACA;;EA1MA;AAnLA","names":["Chart","Title","ArcElement","Tooltip","Legend","BarElement","CategoryScale","LinearScale","LineElement","PointElement","ChartJS","name","components","Bar","Doughnut","LineChartGenerator","props","chartId","type","default","datasetIdKey","width","height","cssClasses","styles","plugins","data","fechaInicio","fechaFin","estado","solicitudes","materiales","preTitulo","solicitudesFiltradas","NombreSolicitate","busquedaCodigo","subsede","acceso","chartDataL","labels","datasets","backgroundColor","chartDataP","totalesM","totalesD","dataBar","label","chartOptions","maintainAspectRatio","responsive","chartAreaBorder","borderColor","borderWidth","borderDash","borderDashOffset","chartOptionsBar","indexAxis","solicitudesAceptadasPorMes","solicitudesRechazadasPorMes","chartDataMeses","chartOptionsMeses","beforeMount","methods","obtenersolicitudes","fetch","RUTA_SERVIDOR_LIBROS","then","respuesta","datosRespuesta","solicitud","solicitudesRechazadas","map","mes","cantidadAceptadasPorMes","cantidadRechazadaPorMes","console","catch","groupSolicitudesPorMes","solicitudesPorMes","asignarNombre","filtrarSolicitudes","consultarCantidad","repetir","nombresUnicos","nombre","generarColoresAleatorios","colores"],"sourceRoot":"src/components","sources":["ListarEstadisticasSolicitudes.vue"],"sourcesContent":["<template>\n  <div class=\"px-md-5 px-2\">\n    <br />\n    <!-- <div class=\"form-group\" align=\"center\">\n      <b-row>\n        <b-col>\n          <label>Seleccione el estado del prestamo</label>\n          <br />\n          <select\n            v-model=\"estado\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"custom-select p-1 px-5\"\n            name=\"\"\n            id=\"\"\n          >\n            <option align=\"center\" value=\"-1\">Todos los estados</option>\n            <option align=\"center\" value=\"0\">Solicitud rechazada</option>\n            <option align=\"center\" value=\"1\">Pendiente de respuesta</option>\n            <option align=\"center\" value=\"2\">Solicitud aceptada</option>\n            <option align=\"center\" value=\"3\">Material devuelto</option>\n            <option align=\"center\" value=\"4\">Pendiente de devolucion</option>\n            <option align=\"center\" value=\"5\">Retrasado</option>\n          </select>\n        </b-col>\n        <br />\n        <b-col>\n          <label>Buscar por codigo</label>\n          <input\n            v-model=\"busquedaCodigo\"\n            @keyup=\"filtrarSolicitudes()\"\n            type=\"text\"\n            class=\"form-control\"\n            placeholder=\"Buscar por Codigo\"\n          />\n        </b-col>\n      </b-row>\n      <br />\n\n      <label>Seleccione el rango de fechas</label><br />\n      <b-row cols=\"2\">\n        <b-col>\n          <input\n            type=\"date\"\n            v-model=\"fechaInicio\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"form-control\"\n            name=\"\"\n            id=\"\"\n          />\n        </b-col>\n        <b-col>\n          <input\n            type=\"date\"\n            v-model=\"fechaFin\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"form-control\"\n            name=\"\"\n            id=\"\"\n          />\n        </b-col>\n      </b-row>\n      <br />\n    </div>\n\n    <button type=\"button\" class=\"btn\" @click=\"imprimirSolicitudes()\">\n      <img\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChklEQVR4nO2Z22vTcBTH+08UrcpASE1SrQ1ug9i5sU1l4pQpE2XTubeBoOANxSdFUcELClNURGhZH0TFMh+com4Im+iDQ0HmEPVBENKbcfSS3tav/H5j6VYzy1zSVsmBz0M5/NJPT8/v5JfWYjGjROFkWafLzvXojcA4dugq6mK4g4KdhyEw3IV/Q9TOw8VwF3UXvSNUYaB6yYIY9t6G/8QhrF3B5WXt/HldRUdqbJBE64JIjY4gfvcWBqttcM+UZfhLFSkqiVZ9ZY0UlfSUNVpU0pAVGP5yRYpKmrLcybKLKk8fINzV9Bsvt9WhlnVMyw6VXfRPsblxQ2WIBltXIrR9zZy0OCqkolIRWljWFIVZ0fmE2aOiuZl4dTyFO9ZBedGvEvNdQ6i9Rt1UyjO/mks88mHi9H4E6peq+fDe5lnrCfLxbv3H0499bfQuQm6FRCTzdRy5eBSh9lqax2QWqbfDSPi9SL56jlxSQebTBwQ3sTQvH+mcWv/4Hl1PkA93GCcaahPoa1KtbOA7Yp4rqujEmQP5Cu5yY1KOQHlyf5ZocKPd2IFfKCq5FyH77QvivuuaopJoRbT3FHKpJP1Q06JkfaB5OYVcwzDRmPcqojfOIvV6EMikae/NJSof65qq4pZVqujMCHfWGyea+TyG9Md3dDNEelpVKWhV9OY55JQEpDqbKkquE+leTwk0LCvBV18ACkSJSC76Ewm/p8w9qiGaHhullU6/f0PbgpxDaS+WUjS0U6SjR+uNCImHHponxPp6IR/dA8m9OD8Fdjcg0d+HQGOVecyDeXAWzRO+1XxmEhY6nvT42XGgCE16zNESM/R/ijoN+rPBVYTVDLt1XqJmWP4ufgGVhSpkgRcCwgAAAABJRU5ErkJggg==\"\n      />\n    </button>\n    <button type=\"button\" class=\"btn\" @click=\"exportarAExcel()\">\n      <img\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVR4nO2ZW0sUYRjH5xvkRcieRnfNPZhtuTNBalgNaemaRUWQ6a5p2slq14Uyd6edGTpQKBFhRQXiTV0pXnQhEmLuTF/E+h7/eN+VocBK2Tks8v7hf/E+8w48v3kON8NxTExMu1/id61X1NWfoqGhUtc+Tc45DiDo2g8rkieukSXUFKTnjgKIFiVvAjgNIdoB4CSEaBeA7BCErQCyAxC2A8g2QzgCINsI4RiAbBOElQB7n3T/F2JPQVKrFqBpKbMtiNoXfXNVCbATcwxgU6wCBmuhyrRrW2jfs0vgJ07hwMIEPTd/Gqfn2MdRxBey4DOd2D9/8493Di7lUD/VC//YMfivH0d45op7APHFLDypVgQLfRB0FYG7J2liiVUZzZ/vwDN4BLH3I+Z9csc32kEdfTOE6OwQwi8H3F2jDdoFChGe6acJN83fKFdjC4CWr3ka4zNdENaK7rcQTWolD+9wO4Won0ya8a0AiEm1SNw31oHI6xTEkuIuwKEvD+BJt8Gbbit/2ZL6TwBxXaEx/60T9HlIPusigK6i7n4PfMNHEZlNlxN+e/XvAOtK2WQevhURuC3Bm2qls+EKQOzDNZpk5NWgOcQEJrEyZQLU5U4jpJ2nJpspMC6hcbofjdOXaeX4bJdLFSgpCBXPIZg/g8TaI3ONBieTiL4bQXwxR2fid5MVSoaerFf+XicaHl9Ey/JDd2fATnMMYFOsAgZrocrEWshgLVSZWAsZrIWq5xfTdi0Y6gZnlQ7rWo+TEIKhbiRKSrdlAExMTFzV6hfz8wpqDZBppQAAAABJRU5ErkJggg==\"\n      />\n    </button>\n    <br />\n    <br /> -->\n\n    <div class=\"row\">\n      <div class=\"col-12 px-md-5\">\n        <LineChartGenerator\n          :options=\"chartOptionsMeses\"\n          :data=\"chartDataMeses\"\n          :width=\"width\"\n          :height=\"height\"\n        />\n      </div>\n\n      <div class=\"col-sm-6 col-md-6 mt-5\">\n        <div align=\"center\">Prestamos totales : {{ totalesM }}</div>\n        <Doughnut\n          v-if=\"chartDataL.labels.length\"\n          id=\"my-chart-id\"\n          :options=\"chartOptions\"\n          :data=\"chartDataL\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { Bar } from \"vue-chartjs\";\nimport {\n  Chart as ChartJS,\n  Title,\n  ArcElement,\n  Tooltip,\n  Legend,\n  BarElement,\n  CategoryScale,\n  LinearScale,\n  LineElement,\n  PointElement,\n} from \"chart.js\";\nimport { Doughnut } from \"vue-chartjs\";\nimport { Line as LineChartGenerator } from \"vue-chartjs\";\nChartJS.register(\n  Title,\n  ArcElement,\n  Tooltip,\n  Legend,\n  BarElement,\n  CategoryScale,\n  LinearScale,\n  LineElement,\n  PointElement\n);\n\nimport axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\nexport default {\n  name: \"ListarEstadisticas\",\n\n  components: {\n    Bar,\n    Doughnut,\n    LineChartGenerator,\n\n    // modalPrestamo,\n    // Loading\n    // CrearLibro,\n    // Carousel,\n    // Slide\n  },\n  props: {\n    chartId: {\n      type: String,\n      default: \"line-chart\",\n    },\n    datasetIdKey: {\n      type: String,\n      default: \"label\",\n    },\n    width: {\n      type: Number,\n      default: 400,\n    },\n    height: {\n      type: Number,\n      default: 400,\n    },\n    cssClasses: {\n      default: \"\",\n      type: String,\n    },\n    styles: {\n      type: Object,\n      default: () => {},\n    },\n    plugins: {\n      type: Array,\n      default: () => [],\n    },\n  },\n\n  data() {\n    return {\n      fechaInicio: \"\",\n      fechaFin: \"\",\n      estado: -1,\n      solicitudes: [],\n      materiales: [],\n      preTitulo: {},\n\n      solicitudesFiltradas: [],\n      NombreSolicitate: [],\n      busquedaCodigo: \"\",\n      subsede: localStorage.getItem(\"idSubsede\"),\n      acceso: localStorage.getItem(\"acceso\"),\n      chartDataL: {\n        labels: [],\n        datasets: [\n          {\n            backgroundColor: [\n              \"#41B883\",\n              \"#E46651\",\n              \"#00D8FF\",\n              \"#DD1B16\",\n              \"#E412351\",\n              \"#45D8FF\",\n              \"#aa1B16\",\n            ],\n            data: [],\n          },\n        ],\n      },\n      chartDataP: {\n        labels: [],\n        datasets: [\n          {\n            backgroundColor: [\n              \"#41B883\",\n              \"#E46651\",\n              \"#00D8FF\",\n              \"#DD1B16\",\n              \"#E412351\",\n              \"#45D8FF\",\n              \"#aa1B16\",\n            ],\n            data: [],\n          },\n        ],\n      },\n\n      totalesM: 0,\n      totalesD: 0,\n      dataBar: {\n        labels: [],\n        datasets: [\n          {\n            backgroundColor: \"#33C4FF\",\n            label: [],\n            data: [],\n          },\n          {\n            backgroundColor: \"#54FF7E\",\n            label: [],\n            data: [],\n          },\n        ],\n      },\n\n      chartOptions: {\n        maintainAspectRatio: true,\n        responsive: true,\n        plugins: {\n          chartAreaBorder: {\n            borderColor: \"red\",\n            borderWidth: 2,\n            borderDash: [5, 5],\n            borderDashOffset: 2,\n          },\n        },\n      },\n      chartOptionsBar: {\n        indexAxis: \"y\",\n        maintainAspectRatio: true,\n        responsive: true,\n      },\n      //////\n      // Almacenar las solicitudes aceptadas por mes\n      solicitudesAceptadasPorMes: [],\n\n      // Almacenar las solicitudes rechazadas por mes\n      solicitudesRechazadasPorMes: [],\n\n      chartDataMeses: {\n        labels: [\n          \"Enero\",\n          \"Febrero\",\n          \"Marzo\",\n          \"Abril\",\n          \"Mayo\",\n          \"Junio\",\n          \"Julio\",\n          \"Agosto\",\n          \"Septiembre\",\n          \"Octubre\",\n          \"Noviembre\",\n          \"Diciembre\",\n        ],\n        datasets: [\n          {\n            label: \"Solicitudes aceptadas\",\n            backgroundColor: \"rgba(75, 192, 192, 0.6)\", // Cambia el color de fondo\n            borderColor: \"rgba(75, 192, 192, 1)\", // Cambia el color de la línea\n            borderWidth: 1, // Ancho de la línea\n            data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n          },\n          {\n            label: \"Solicitudes Rechazadas\",\n            backgroundColor: \"rgba(255, 0, 0, 0.6)\", // Cambia el color de fondo\n            borderColor: \"rgba(255, 0, 0, 1)\", // Cambia el color de la línea\n            borderWidth: 1, // Ancho de la línea\n            data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n          },\n        ],\n      },\n      chartOptionsMeses: {\n        responsive: true,\n        maintainAspectRatio: false,\n      },\n    };\n  },\n\n  beforeMount() {\n    this.obtenersolicitudes();\n  },\n\n  methods: {\n    obtenersolicitudes() {\n      fetch(\n        RUTA_SERVIDOR_LIBROS + \"/prestamo/\" + localStorage.getItem(\"idSubsede\")\n      )\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          this.solicitudes = datosRespuesta.reverse();\n          const solicitudesAceptadas = datosRespuesta.filter(\n            (solicitud) =>\n              solicitud.estado === 2 ||\n              solicitud.estado === 3 ||\n              solicitud.estado === 4 ||\n              solicitud.estado === 5\n          );\n\n          const solicitudesRechazadas = datosRespuesta.filter(\n            (solicitud) => solicitud.estado === 0 // Cambiar el estado al que corresponde a \"Solicitud rechazada\"\n          );\n\n          // Almacenar las solicitudes aceptadas y rechazadas en variables separadas\n          this.solicitudesAceptadas = solicitudesAceptadas;\n          this.solicitudesRechazadas = solicitudesRechazadas;\n\n          // Agrupar las solicitudes por mes\n          this.solicitudesAceptadasPorMes =\n            this.groupSolicitudesPorMes(solicitudesAceptadas);\n          this.solicitudesRechazadasPorMes = this.groupSolicitudesPorMes(\n            solicitudesRechazadas\n          );\n        })\n        .then(() => {\n          const cantidadAceptadasPorMes = Object.values(\n            this.solicitudesAceptadasPorMes\n          ).map((mes) => mes.length);\n          this.chartDataMeses.datasets[0].data.map((data, index) => {\n            this.chartDataMeses.datasets[0].data[index] =\n              cantidadAceptadasPorMes[index];\n          });\n\n          const cantidadRechazadaPorMes = Object.values(\n            this.solicitudesRechazadasPorMes\n          ).map((mes) => mes.length);\n          this.chartDataMeses.datasets[1].data.map((data, index) => {\n            this.chartDataMeses.datasets[1].data[index] =\n              cantidadRechazadaPorMes[index];\n          });\n\n          console.log(this.chartDataMeses);\n          for (let index = 0; index < this.solicitudes.length; index++) {\n            this.asignarNombre(\n              this.solicitudes[index].codigoUsuario,\n              this.solicitudes[index].id\n            );\n          }\n        })\n        .catch(console.log);\n    },\n\n    groupSolicitudesPorMes(solicitudes) {\n      const solicitudesPorMes = {};\n\n      const yearActual = new Date().getFullYear();\n\n      // Inicializar el objeto con todas las fechas de los meses del año actual\n      for (let month = 0; month < 12; month++) {\n        const mesKey = `${yearActual}-${month + 1}`;\n        solicitudesPorMes[mesKey] = [];\n      }\n\n      solicitudes.forEach((solicitud) => {\n        const fechaPrestamo = new Date(solicitud.fechaPrestamo);\n        const mes = fechaPrestamo.getMonth();\n        const year = fechaPrestamo.getFullYear();\n\n        if (year === yearActual) {\n          const mesKey = `${year}-${mes + 1}`;\n\n          solicitudesPorMes[mesKey].push(solicitud);\n        }\n      });\n\n      return solicitudesPorMes;\n    },\n\n    asignarNombre(codigoAlumnon, index) {\n      if (this.NombreSolicitate[index] == undefined) {\n        fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + codigoAlumnon)\n          .then((respuesta) => respuesta.json())\n          .then((datosRespuesta) => {\n            this.filtrarSolicitudes();\n            this.NombreSolicitate[index] =\n              datosRespuesta.nombre +\n              \" \" +\n              datosRespuesta.ap_paterno +\n              \" \" +\n              datosRespuesta.ap_materno;\n          });\n      } else {\n        return;\n      }\n    },\n\n    filtrarSolicitudes() {\n      // Filtrar por estado\n      let solicitudesFiltradas = this.solicitudes.filter((solicitud) => {\n        return this.estado == -1 || solicitud.estado === parseInt(this.estado);\n      });\n      solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n        // Comprobar si el código de usuario o el título contiene la cadena de búsqueda\n        return (\n          solicitud.estado === 2 ||\n          solicitud.estado === 3 ||\n          solicitud.estado === 4 ||\n          solicitud.estado === 5\n        );\n      });\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n          return (\n            solicitud.fechaPrestamo >= this.fechaInicio &&\n            solicitud.fechaPrestamo <= this.fechaFin\n          );\n        });\n      }\n      // Filtrar por fecha de préstamo si se proporcionan fechas válidas\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n          return (\n            solicitud.fechaPrestamo >= this.fechaInicio &&\n            solicitud.fechaPrestamo <= this.fechaFin\n          );\n        });\n      }\n\n      // Filtrar por código de usuario (coincidencia parcial)\n      if (this.busquedaCodigo !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n          // Comprobar si el código de usuario o el título contiene la cadena de búsqueda\n          return (\n            solicitud.codigoUsuario.includes(this.busquedaCodigo) ||\n            solicitud.titulo.includes(this.busquedaCodigo)\n          );\n        });\n      } else {\n        // Si no hay cadena de búsqueda, mantener los filtros anteriores\n        // (no es necesario cambiar nada aquí)\n      }\n\n      // El resto del código permanece igual\n      this.solicitudesFiltradas = solicitudesFiltradas;\n\n      this.consultarCantidad();\n    },\n\n    consultarCantidad() {\n      this.totalesM = 0;\n\n      const repetir = {};\n      const nombresUnicos = []; // Un arreglo para almacenar los nombres únicos\n\n      for (let i = 0; i < this.solicitudesFiltradas.length; i++) {\n        const obj = this.solicitudesFiltradas[i];\n        const nombre = obj.titulo;\n\n        if (repetir[nombre]) {\n          repetir[nombre]++;\n        } else {\n          repetir[nombre] = 1;\n          nombresUnicos.push(nombre); // Agregar el nombre único al arreglo\n        }\n        this.totalesM++;\n      }\n      this.chartDataL.datasets[0].data = [];\n      this.chartDataL.labels = [];\n      this.chartDataL.datasets[0].backgroundColor = [];\n      const coloresAleatorios = this.generarColoresAleatorios(\n        nombresUnicos.length\n      );\n\n      // Limpia el array de labels antes de agregar el nuevo resultado\n      this.chartDataL.labels = nombresUnicos.map(\n        (nombre) => `${nombre}: ${repetir[nombre]}`\n      ); // Almacena los nombres únicos\n      this.chartDataL.datasets[0].data = nombresUnicos.map(\n        (nombre) => repetir[nombre]\n      ); // Almacena la cantidad de repeticiones para cada nombre\n\n      this.chartDataL.datasets[0].backgroundColor = coloresAleatorios;\n    },\n    generarColoresAleatorios(cantidad) {\n      const colores = [];\n      for (let i = 0; i < cantidad; i++) {\n        const r = Math.floor(Math.random() * 100) + 155; // Componente rojo en el rango de 155 a 255\n        const g = Math.floor(Math.random() * 100) + 155; // Componente verde en el rango de 155 a 255\n        const b = Math.floor(Math.random() * 100) + 155; // Componente azul en el rango de 155 a 255\n\n        const color = `rgb(${r},${g},${b})`;\n        colores.push(color);\n      }\n\n      return colores;\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}