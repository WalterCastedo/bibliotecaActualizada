{"ast":null,"code":"import axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\nimport { jsPDF } from \"jspdf\";\nimport \"jspdf-autotable\";\nexport default {\n  data() {\n    return {\n      elementosPorPagina: 5,\n      busquedaCodigo: \"\",\n      fechaInicio: \"\",\n      fechaFin: \"\",\n      estado: -1,\n      solicitudes: [],\n      materiales: [],\n      preTitulo: {},\n      solicitudesFiltradas: [],\n      datosPaginados: [],\n      paginaActual: 1,\n      NombreSolicitate: []\n    };\n  },\n\n  mounted() {\n    this.obtenersolicitudes();\n  },\n\n  methods: {\n    cambiarRegistrosPorPagina() {\n      this.paginaActual = 1;\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n\n    obtenersolicitudes() {\n      fetch(RUTA_SERVIDOR_LIBROS + \"/prestamo/\" + localStorage.getItem(\"idSubsede\")).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        this.solicitudes = datosRespuesta.reverse();\n      }).then(() => {\n        for (let index = 0; index < this.solicitudes.length; index++) {\n          this.asignarNombre(this.solicitudes[index].codigoUsuario, this.solicitudes[index].id);\n        }\n      }).catch(console.log);\n    },\n\n    asignarNombre(codigoAlumnon, index) {\n      if (this.NombreSolicitate[index] == undefined) {\n        fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + codigoAlumnon).then(respuesta => respuesta.json()).then(datosRespuesta => {\n          this.filtrarSolicitudes();\n          this.NombreSolicitate[index] = datosRespuesta.nombre + \" \" + datosRespuesta.ap_paterno + \" \" + datosRespuesta.ap_materno;\n        });\n      } else {\n        return;\n      }\n    },\n\n    quitarAcentosYMinusculas(cadena) {\n      return cadena.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\").toLowerCase();\n    },\n\n    filtrarSolicitudes() {\n      // Filtrar por estado\n      let solicitudesFiltradas = this.solicitudes.filter(solicitud => {\n        return this.estado == -1 || solicitud.estado === parseInt(this.estado);\n      });\n\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n          return solicitud.fechaPrestamo >= this.fechaInicio && solicitud.fechaPrestamo <= this.fechaFin;\n        });\n      } // Filtrar por código de usuario (coincidencia parcial)\n\n\n      if (this.busquedaCodigo !== \"\") {\n        const busquedaNormalizada = this.quitarAcentosYMinusculas(this.busquedaCodigo);\n        solicitudesFiltradas = solicitudesFiltradas.filter(solicitud => {\n          const codigoUsuarioNormalizado = this.quitarAcentosYMinusculas(solicitud.codigoUsuario);\n          const tituloNormalizado = this.quitarAcentosYMinusculas(solicitud.titulo);\n          return codigoUsuarioNormalizado.includes(busquedaNormalizada) || tituloNormalizado.includes(busquedaNormalizada);\n        }); // No es necesario repetir el bloque de fecha aquí\n      } else {// Si no hay cadena de búsqueda, mantener los filtros anteriores\n        // (no es necesario cambiar nada aquí)\n      } // El resto del código permanece igual\n\n\n      this.solicitudesFiltradas = solicitudesFiltradas; // Realizar alguna acción, como obtener datos de una página\n\n      this.ObtenerDatosPag(1); // Manejo de errores o retroceso de página si no se encontraron resultados\n\n      if (solicitudesFiltradas.length === 0) {\n        this.paginaPrevia();\n      }\n    },\n\n    totalPaginas() {\n      if (this.elementosPorPagina === -1) {\n        return 1; // Mostrar todo en una sola página\n      }\n\n      return Math.ceil(this.solicitudesFiltradas.length / this.elementosPorPagina);\n    },\n\n    ObtenerDatosPag(noPag) {\n      this.paginaActual = noPag;\n      this.datosPaginados = [];\n      let ini = noPag * this.elementosPorPagina - this.elementosPorPagina;\n      let fin = noPag * this.elementosPorPagina;\n      this.datosPaginados = this.solicitudesFiltradas.slice(ini, fin);\n    },\n\n    paginaPrevia() {\n      if (this.paginaActual > 1) {\n        this.paginaActual--;\n      }\n\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n\n    paginaSiguiente() {\n      if (this.paginaActual < this.totalPaginas()) {\n        this.paginaActual++;\n      }\n\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n\n    activo(noPoag) {\n      return noPoag === this.paginaActual ? \"active\" : \"\";\n    },\n\n    eliminarSolicitud(solicitud, nombre) {\n      const confirmacion = window.confirm('¿Estás seguro de que deseas cancelar esta solicitud?');\n\n      if (confirmacion) {\n        var valor;\n\n        if (solicitud.estado == 2) {\n          valor = 1;\n        } else {\n          valor = 0;\n        }\n\n        try {\n          axios.put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            idSubsede: solicitud.idSubsede,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"Prestamo rechazado por el bibliotecario\",\n            estado: 0,\n            activo: 1,\n            telefono: solicitud.telefono\n          }).then(function () {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial).then(respuesta => respuesta.json()).then(datosRespuesta => {\n              {\n                axios.put(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial, {\n                  titulo: datosRespuesta.titulo,\n                  copias: datosRespuesta.copias,\n                  idTipomaterial: datosRespuesta.idTipomaterial,\n                  copiasDisponibles: datosRespuesta.copiasDisponibles + valor,\n                  edicion: datosRespuesta.edicion,\n                  codigo: datosRespuesta.codigo,\n                  idAutor: parseInt(datosRespuesta.idAutor),\n                  idEmpleado: datosRespuesta.idEmpleado,\n                  idEditorial: parseInt(datosRespuesta.idEditorial),\n                  idCarrera: parseInt(datosRespuesta.idCarrera),\n                  urlPortada: datosRespuesta.urlPortada,\n                  observacion: datosRespuesta.observacion,\n                  activo: 1\n                }).then(function () {\n                  if (solicitud.telefono != null) {\n                    window.open(\"https://api.whatsapp.com/send?phone=591\" + solicitud.telefono + \"&text=Hola \" + nombre + \", nos comunicamos desde la Universidad Nacional del Oriente sede \" + localStorage.getItem(\"Subsede\") + ', para informarte que tu solicitus del material \"' + solicitud.titulo + '\" a sido rechazada, lamentamos este inconveniente y te pedimos que puedas pasar personalmente por la universidad a realizar la solicitud');\n                  }\n                }).then(function () {\n                  location.reload();\n                }).catch(function (error) {\n                  console.log(error);\n                });\n              }\n            }).catch(console.log);\n          });\n        } catch (error) {\n          console.log(error); // console.log(this.material);\n        }\n      }\n    },\n\n    aceptarSolicitud(solicitud, nombre) {\n      const confirmacion = window.confirm('¿Estás seguro de que deseas acptar esta solicitud?');\n\n      if (confirmacion) {\n        try {\n          axios.put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            idSubsede: solicitud.idSubsede,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"Prestamo aceptado por el bibliotecario\",\n            estado: 2,\n            activo: 1,\n            telefono: solicitud.telefono\n          }).then(function () {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial).then(respuesta => respuesta.json()).then(datosRespuesta => {\n              {\n                axios.put(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial, {\n                  titulo: datosRespuesta.titulo,\n                  copias: datosRespuesta.copias,\n                  idTipomaterial: datosRespuesta.idTipomaterial,\n                  copiasDisponibles: datosRespuesta.copiasDisponibles - 1,\n                  edicion: datosRespuesta.edicion,\n                  codigo: datosRespuesta.codigo,\n                  idAutor: parseInt(datosRespuesta.idAutor),\n                  idEmpleado: datosRespuesta.idEmpleado,\n                  idEditorial: parseInt(datosRespuesta.idEditorial),\n                  idCarrera: parseInt(datosRespuesta.idCarrera),\n                  urlPortada: datosRespuesta.urlPortada,\n                  observacion: datosRespuesta.observacion,\n                  activo: 1\n                }).then(function () {\n                  if (solicitud.telefono != null) {\n                    window.open(\"https://api.whatsapp.com/send?phone=591\" + solicitud.telefono + \"&text=Hola%20\" + nombre + \",nos comunicamos desde la Universidad Nacional del Oriente sede%20\" + localStorage.getItem(\"Subsede\") + ', para informarte que tu solicitus del material \"' + solicitud.titulo + '\" a sido aprobada, y puedes pasar a recogerlo en la fecha prevista.');\n                  }\n                }).then(function () {\n                  location.reload();\n                }).catch(function (error) {\n                  console.log(error);\n                });\n              }\n            }).catch(console.log);\n          });\n        } catch (error) {\n          console.log(error); // console.log(this.material);\n        }\n      }\n    },\n\n    devolverMaterial(solicitud) {\n      const confirmacion = window.confirm(\"¿Estás seguro de que deseas devolver el material?\");\n\n      if (confirmacion) {\n        var estado1 = 0;\n\n        if (solicitud.estado == 3) {\n          estado1 = 4;\n        }\n\n        if (solicitud.estado == 4 || solicitud.estado == 5) {\n          estado1 = 3;\n        }\n\n        axios.put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n          idEmpleado: solicitud.idEmpleado,\n          codigoUsuario: solicitud.codigoUsuario,\n          idMaterial: solicitud.idMaterial,\n          cantidad: solicitud.cantidad,\n          idSubsede: solicitud.idSubsede,\n          fechaPrestamo: solicitud.fechaPrestamo,\n          fechaDevolucion: solicitud.fechaDevolucion,\n          observacion: \"material devulto\",\n          estado: estado1,\n          activo: 1,\n          telefono: solicitud.telefono\n        }).then(function () {\n          if (estado1 == 3) {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial).then(respuesta => respuesta.json()).then(datosRespuesta => {\n              axios.put(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial, {\n                titulo: datosRespuesta.titulo,\n                copias: datosRespuesta.copias,\n                idTipomaterial: datosRespuesta.idTipomaterial,\n                copiasDisponibles: datosRespuesta.copiasDisponibles + 1,\n                edicion: datosRespuesta.edicion,\n                codigo: datosRespuesta.codigo,\n                idAutor: parseInt(datosRespuesta.idAutor),\n                idEmpleado: datosRespuesta.idEmpleado,\n                idEditorial: parseInt(datosRespuesta.idEditorial),\n                idCarrera: parseInt(datosRespuesta.idCarrera),\n                urlPortada: datosRespuesta.urlPortada,\n                observacion: datosRespuesta.observacion,\n                activo: 1\n              }).then(function () {\n                location.reload();\n              }).catch(function (error) {\n                console.log(error);\n              });\n            }).catch(console.log);\n          } else {\n            location.reload();\n          }\n        }).catch(function (error) {\n          console.log(error); // console.log(this.material);\n        });\n      }\n    },\n\n    exportarAExcel() {\n      // Crear una tabla HTML con los datos que deseas exportar\n      const tabla = document.createElement(\"table\");\n      const thead = tabla.createTHead();\n      const tbody = tabla.createTBody(); // Agregar encabezados de columna a la tabla\n\n      const encabezados = [\"Solicitante\", \"material solicitado\", \"Cantidad\", \"Fecha de préstamo\", \"Fecha de devolución\", \"Estado\"];\n      const encabezadosRow = thead.insertRow();\n      encabezados.forEach(encabezado => {\n        const th = document.createElement(\"th\");\n        th.innerText = encabezado;\n        encabezadosRow.appendChild(th);\n      }); // Agregar filas de datos a la tabla\n\n      this.datosPaginados.forEach(solicitud => {\n        const fila = tbody.insertRow();\n        fila.insertCell().innerText = this.NombreSolicitate[solicitud.id];\n        fila.insertCell().innerText = solicitud.titulo;\n        fila.insertCell().innerText = solicitud.cantidad;\n        fila.insertCell().innerText = solicitud.fechaPrestamo;\n        fila.insertCell().innerText = solicitud.fechaDevolucion;\n        fila.insertCell().innerText = solicitud.estado === 0 ? \"Solicitud rechazada\" : solicitud.estado === 1 ? \"Pendiente de respuesta\" : solicitud.estado === 2 ? \"Solicitud aceptada\" : solicitud.estado === 3 ? \"material devuelto\" : solicitud.estado === 4 ? \"Pendiente de devolución\" : solicitud.estado === 5 ? \"Retrasado\" : \"noc\";\n      }); // Crear un archivo Blob para la tabla HTML\n\n      const blob = new Blob([tabla.outerHTML], {\n        type: \"application/vnd.ms-excel\"\n      }); // Crear un enlace para descargar el archivo Excel\n\n      const link = document.createElement(\"a\");\n      link.href = URL.createObjectURL(blob);\n      link.download = \"solicitudes.xls\"; // Simular un clic en el enlace para iniciar la descarga\n\n      link.click();\n    },\n\n    entregarMaterial(solicitud) {\n      const confirmacion = window.confirm('¿Estás seguro de que deseas entregar el material solicitado?');\n\n      if (confirmacion) {\n        try {\n          var estado1 = 0;\n\n          if (solicitud.estado == 4) {\n            estado1 = 2;\n          }\n\n          if (solicitud.estado == 2) {\n            estado1 = 4;\n          }\n\n          axios.put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            idSubsede: solicitud.idSubsede,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"material entregado por el bibliotecario\",\n            estado: estado1,\n            activo: 1,\n            telefono: solicitud.telefono\n          }).then(function () {\n            location.reload();\n          });\n        } catch (error) {\n          console.log(error); // console.log(this.material);\n        }\n      }\n    },\n\n    imprimirSolicitud(solicitud, nombre) {\n      //crear archivo pdf\n      var doc = new jsPDF();\n      doc.setFontSize(20);\n      doc.text(20, 20, \"Solicitud de prestamo\"); //colocar logo\n\n      doc.addImage;\n      doc.text(180, 20, \"UNO\");\n      doc.setFontSize(12);\n      doc.text(20, 30, \"Nombre: \" + nombre);\n      doc.text(20, 40, \"Codigo de usuario: \" + solicitud.codigoUsuario);\n      doc.text(20, 50, \"material: \" + solicitud.titulo);\n      doc.text(20, 60, \"Cantidad: \" + solicitud.cantidad);\n      doc.text(20, 70, \"Fecha de prestamo: \" + solicitud.fechaPrestamo);\n      doc.text(20, 80, \"Fecha de devolucion: \" + solicitud.fechaDevolucion);\n      doc.text(20, 100, \"Firma del alumno:______________________\");\n      doc.text(0, 140, \"----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\");\n      doc.setFontSize(20);\n      doc.text(20, 170, \"Solicitud de prestamo\");\n      doc.text(180, 170, \"UNO\");\n      doc.setFontSize(12);\n      doc.text(20, 180, \"Nombre: \" + nombre);\n      doc.text(20, 190, \"Codigo de usuario: \" + solicitud.codigoUsuario);\n      doc.text(20, 200, \"material: \" + solicitud.titulo);\n      doc.text(20, 210, \"Cantidad: \" + solicitud.cantidad);\n      doc.text(20, 220, \"Fecha de prestamo: \" + solicitud.fechaPrestamo);\n      doc.text(20, 230, \"Fecha de devolucion: \" + solicitud.fechaDevolucion);\n      doc.text(20, 250, \"Firma del alumno:______________________\"); // doc.text(20, 90, \"Observacion: \" + solicitud.observacion);\n      // doc.text(20, 100, \"Estado: \" + solicitud.estado);\n      // doc.text(20, 110, \"Subsede: \" + solicitud.subsede);\n      // doc.text(20, 120, \"Telefono: \" + solicitud.telefono);\n\n      doc.save(\"solicitud.pdf\");\n    },\n\n    imprimirSolicitudes() {\n      // Crear un nuevo documento PDF\n      var doc = new jsPDF(); //titulo\n\n      doc.setFontSize(16);\n      var title = \"Solicitudes\";\n      var titleWidth = doc.getStringUnitWidth(title) * doc.internal.getFontSize() / doc.internal.scaleFactor;\n      var pageWidth = doc.internal.pageSize.getWidth();\n      var x = (pageWidth - titleWidth) / 2;\n      doc.text(title, x, 10); // Obtener la tabla visible\n\n      var table = document.querySelector('.tableMb'); // Obtener la tabla visible\n\n      var table = document.querySelector(\".tableMb\"); // Configurar los estilos de la tabla\n\n      var styles = {\n        overflow: \"linebreak\",\n        fontSize: 8,\n        // Tamaño de fuente reducido\n        lineWidth: 0.1,\n        lineColor: [0, 0, 0],\n        // Color de las líneas\n        font: \"helvetica\",\n        fontStyle: \"normal\",\n        halign: \"center\",\n        // Alineación horizontal\n        valign: \"middle\",\n        // Alineación vertical\n        cellPadding: 2,\n        tableWidth: \"auto\",\n        tableBorder: 1,\n        tableLineColor: [0, 0, 0],\n        // Color del borde de la tabla\n        tableFillColor: [255, 255, 255],\n        // Color de fondo de la tabla\n        textColor: 0,\n        cellWidth: \"auto\" // Ajustar el ancho de la celda automáticamente\n\n      }; // Ocultar la última columna (Acción) antes de agregar la tabla al documento PDF\n\n      var actionColumn = table.querySelector(\"th:last-child, td:last-child\");\n\n      if (actionColumn) {\n        actionColumn.style.display = \"none\";\n      } // Agregar la tabla al documento PDF\n\n\n      doc.autoTable({\n        html: table,\n        startY: 20,\n        styles\n      }); // Mostrar la última columna nuevamente\n\n      if (actionColumn) {\n        actionColumn.style.display = \"table-cell\";\n      } // Guardar el PDF\n\n\n      doc.save(\"solicitudes.pdf\");\n    }\n\n  }\n};","map":{"version":3,"mappings":"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C,KAlDA,CAkDA;UACAC,mBADA,CAEA;QACA,CArDA;MAsDA;IACA,CAxWA;;IAyWA6C;MACA;MACA;MACA;MACA,kCAJA,CAMA;;MACA,qBACA,aADA,EAEA,qBAFA,EAGA,UAHA,EAIA,mBAJA,EAKA,qBALA,EAMA,QANA;MAQA;MACAC;QACA;QACAC;QACAC;MACA,CAJA,EAhBA,CAsBA;;MACA;QACA;QACAC;QACAA;QACAA;QACAA;QACAA;QACAA,8BACA1C,yBACA,qBADA,GAEAA,yBACA,wBADA,GAEAA,yBACA,oBADA,GAEAA,yBACA,mBADA,GAEAA,yBACA,yBADA,GAEAA,yBACA,WADA,GAEA,KAbA;MAcA,CArBA,EAvBA,CA8CA;;MACA;QACA2C;MADA,GA/CA,CAmDA;;MACA;MACAC;MACAA,kCAtDA,CAwDA;;MACAA;IACA,CAnaA;;IAqaAC;MACA,oCACA,8DADA;;MAIA;QACA;UACA;;UACA;YACAR;UACA;;UACA;YACAA;UACA;;UACA3B,MACAC,GADA,CACAvB,mDADA,EACA;YACAwB,gCADA;YAEAC,sCAFA;YAGAC,gCAHA;YAIAC,4BAJA;YAKAE,8BALA;YAMAD,sCANA;YAOAE,0CAPA;YAQAC,sDARA;YASA5C,eATA;YAUAgC,SAVA;YAWAa;UAXA,CADA,EAcA/B,IAdA,CAcA;YACA6C;UACA,CAhBA;QAiBA,CAzBA,CAyBA;UACAzC,mBADA,CAEA;QACA;MACA;IACA,CAzcA;;IA0cAqD;MACA;MACA;MACAC;MACAA,0CAJA,CAKA;;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA,SACA,CADA,EAEA,GAFA,EAGA,kNAHA;MAMAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA;MACAA,6DAhCA,CAiCA;MACA;MACA;MACA;;MACAA;IACA,CAhfA;;IAkfAC;MACA;MACA,sBAFA,CAGA;;MACAD;MACA;MACA;MACA;MACA;MACAA,uBATA,CAUA;;MACA,+CAXA,CAaA;;MACA,+CAdA,CAgBA;;MACA;QACAE,qBADA;QAEAC,WAFA;QAEA;QACAC,cAHA;QAIAC,oBAJA;QAIA;QACAC,iBALA;QAMAC,mBANA;QAOAC,gBAPA;QAOA;QACAC,gBARA;QAQA;QACAC,cATA;QAUAC,kBAVA;QAWAC,cAXA;QAYAC,yBAZA;QAYA;QACAC,+BAbA;QAaA;QACAC,YAdA;QAeAC,iBAfA,CAeA;;MAfA,EAjBA,CAmCA;;MACA;;MACA;QACAC;MACA,CAvCA,CAyCA;;;MACAjB;QAAAkB;QAAAC;QAAAC;MAAA,GA1CA,CA4CA;;MACA;QACAH;MACA,CA/CA,CAiDA;;;MACAjB;IACA;;EAriBA;AAtBA","names":["data","elementosPorPagina","busquedaCodigo","fechaInicio","fechaFin","estado","solicitudes","materiales","preTitulo","solicitudesFiltradas","datosPaginados","paginaActual","NombreSolicitate","mounted","methods","cambiarRegistrosPorPagina","obtenersolicitudes","fetch","RUTA_SERVIDOR_LIBROS","then","respuesta","datosRespuesta","catch","console","asignarNombre","quitarAcentosYMinusculas","normalize","replace","toLowerCase","filtrarSolicitudes","solicitud","codigoUsuarioNormalizado","tituloNormalizado","totalPaginas","ObtenerDatosPag","paginaPrevia","paginaSiguiente","activo","eliminarSolicitud","valor","axios","put","idEmpleado","codigoUsuario","idMaterial","cantidad","fechaPrestamo","idSubsede","fechaDevolucion","observacion","telefono","titulo","copias","idTipomaterial","copiasDisponibles","edicion","codigo","idAutor","idEditorial","idCarrera","urlPortada","window","nombre","localStorage","location","aceptarSolicitud","devolverMaterial","estado1","exportarAExcel","encabezados","th","encabezadosRow","fila","type","link","entregarMaterial","imprimirSolicitud","doc","imprimirSolicitudes","overflow","fontSize","lineWidth","lineColor","font","fontStyle","halign","valign","cellPadding","tableWidth","tableBorder","tableLineColor","tableFillColor","textColor","cellWidth","actionColumn","html","startY","styles"],"sourceRoot":"src/components","sources":["ListasolicitudesAdmin.vue"],"sourcesContent":["<template>\n  <div class=\"solicitud px-md-5 px-2\">\n    <br />\n    <div class=\"form-group\" align=\"center\">\n      <b-row >\n        <b-col>\n          <label>Seleccione el estado del prestamo</label>\n          <br />\n          <select\n            v-model=\"estado\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"custom-select p-1 px-5\"\n            name=\"\"\n            id=\"\"\n          >\n            <option align=\"center\" value=\"-1\">Todos los estados</option>\n            <option align=\"center\" value=\"0\">Solicitud rechazada</option>\n            <option align=\"center\" value=\"1\">Pendiente de respuesta</option>\n            <option align=\"center\" value=\"2\">Solicitud aceptada</option>\n            <option align=\"center\" value=\"3\">Material devuelto</option>\n            <option align=\"center\" value=\"4\">Pendiente de devolucion</option>\n            <option align=\"center\" value=\"5\">Retrasado</option>\n          </select>\n        </b-col>\n        <br />\n        <b-col>\n          <label>Buscar por codigo / material</label>\n          <input\n            v-model=\"busquedaCodigo\"\n            @keyup=\"filtrarSolicitudes()\"\n            type=\"text\"\n            class=\"form-control\"\n            placeholder=\"Codigo/material\"\n          />\n        </b-col>\n      </b-row>\n      <br />\n\n      <label>Seleccione el rango de fechas</label><br />\n      <b-row cols=\"2\">\n        <b-col>\n          <input\n            type=\"date\"\n            v-model=\"fechaInicio\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"form-control\"\n            name=\"\"\n            id=\"\"\n          />\n        </b-col>\n        <b-col>\n          <input\n            type=\"date\"\n            v-model=\"fechaFin\"\n            @change=\"filtrarSolicitudes()\"\n            class=\"form-control\"\n            name=\"\"\n            id=\"\"\n          />\n        </b-col>\n      </b-row>\n      <br />\n    </div>\n\n    <label>Registros por página</label>\n    <select v-model=\"elementosPorPagina\" @change=\"cambiarRegistrosPorPagina\">\n      <option value=\"5\" selected>5</option>\n      <option value=\"10\">10</option>\n      <option value=\"20\">20</option>\n      <option value=\"999999\">Todos</option>\n    </select>\n    <button type=\"button\" class=\"btn\" @click=\"imprimirSolicitudes()\">\n      <img\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAqCAYAAADFw8lbAAAACXBIWXMAAAsTAAALEwEAmpwYAAAChklEQVR4nO2Z22vTcBTH+08UrcpASE1SrQ1ug9i5sU1l4pQpE2XTubeBoOANxSdFUcELClNURGhZH0TFMh+com4Im+iDQ0HmEPVBENKbcfSS3tav/H5j6VYzy1zSVsmBz0M5/NJPT8/v5JfWYjGjROFkWafLzvXojcA4dugq6mK4g4KdhyEw3IV/Q9TOw8VwF3UXvSNUYaB6yYIY9t6G/8QhrF3B5WXt/HldRUdqbJBE64JIjY4gfvcWBqttcM+UZfhLFSkqiVZ9ZY0UlfSUNVpU0pAVGP5yRYpKmrLcybKLKk8fINzV9Bsvt9WhlnVMyw6VXfRPsblxQ2WIBltXIrR9zZy0OCqkolIRWljWFIVZ0fmE2aOiuZl4dTyFO9ZBedGvEvNdQ6i9Rt1UyjO/mks88mHi9H4E6peq+fDe5lnrCfLxbv3H0499bfQuQm6FRCTzdRy5eBSh9lqax2QWqbfDSPi9SL56jlxSQebTBwQ3sTQvH+mcWv/4Hl1PkA93GCcaahPoa1KtbOA7Yp4rqujEmQP5Cu5yY1KOQHlyf5ZocKPd2IFfKCq5FyH77QvivuuaopJoRbT3FHKpJP1Q06JkfaB5OYVcwzDRmPcqojfOIvV6EMikae/NJSof65qq4pZVqujMCHfWGyea+TyG9Md3dDNEelpVKWhV9OY55JQEpDqbKkquE+leTwk0LCvBV18ACkSJSC76Ewm/p8w9qiGaHhullU6/f0PbgpxDaS+WUjS0U6SjR+uNCImHHponxPp6IR/dA8m9OD8Fdjcg0d+HQGOVecyDeXAWzRO+1XxmEhY6nvT42XGgCE16zNESM/R/ijoN+rPBVYTVDLt1XqJmWP4ufgGVhSpkgRcCwgAAAABJRU5ErkJggg==\"\n      />\n    </button>\n    <button type=\"button\" class=\"btn\" @click=\"exportarAExcel()\">\n      <img\n        src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTUlEQVR4nO2ZW0sUYRjH5xvkRcieRnfNPZhtuTNBalgNaemaRUWQ6a5p2slq14Uyd6edGTpQKBFhRQXiTV0pXnQhEmLuTF/E+h7/eN+VocBK2Tks8v7hf/E+8w48v3kON8NxTExMu1/id61X1NWfoqGhUtc+Tc45DiDo2g8rkieukSXUFKTnjgKIFiVvAjgNIdoB4CSEaBeA7BCErQCyAxC2A8g2QzgCINsI4RiAbBOElQB7n3T/F2JPQVKrFqBpKbMtiNoXfXNVCbATcwxgU6wCBmuhyrRrW2jfs0vgJ07hwMIEPTd/Gqfn2MdRxBey4DOd2D9/8493Di7lUD/VC//YMfivH0d45op7APHFLDypVgQLfRB0FYG7J2liiVUZzZ/vwDN4BLH3I+Z9csc32kEdfTOE6OwQwi8H3F2jDdoFChGe6acJN83fKFdjC4CWr3ka4zNdENaK7rcQTWolD+9wO4Won0ya8a0AiEm1SNw31oHI6xTEkuIuwKEvD+BJt8Gbbit/2ZL6TwBxXaEx/60T9HlIPusigK6i7n4PfMNHEZlNlxN+e/XvAOtK2WQevhURuC3Bm2qls+EKQOzDNZpk5NWgOcQEJrEyZQLU5U4jpJ2nJpspMC6hcbofjdOXaeX4bJdLFSgpCBXPIZg/g8TaI3ONBieTiL4bQXwxR2fid5MVSoaerFf+XicaHl9Ey/JDd2fATnMMYFOsAgZrocrEWshgLVSZWAsZrIWq5xfTdi0Y6gZnlQ7rWo+TEIKhbiRKSrdlAExMTFzV6hfz8wpqDZBppQAAAABJRU5ErkJggg==\"\n      />\n    </button>\n    <br />\n    <br />\n    <nav aria-label=\"Page navigation example\" class=\"pagination-nav\">\n      <ul align=\"center\" class=\"pagination\">\n        <li class=\"page-item\" v-on:click=\"paginaPrevia()\">\n          <a class=\"page-link\" href=\"#\">anterior</a>\n        </li>\n        <li\n          v-for=\"pagina in totalPaginas()\"\n          :key=\"pagina\"\n          class=\"page-item\"\n          v-bind:class=\"activo(pagina)\"\n        >\n          <a class=\"page-link\" href=\"#\" v-on:click=\"ObtenerDatosPag(pagina)\">{{\n            pagina\n          }}</a>\n        </li>\n        <li class=\"page-item\" v-on:click=\"paginaSiguiente()\">\n          <a class=\"page-link\" href=\"#\">siguiente</a>\n        </li>\n      </ul>\n    </nav>\n    <div class=\"table-responsive\">\n      <table class=\"table table-striped border text-center tableMb\">\n        <thead class=\"thMb\">\n          <tr class=\"trMb\">\n            <th>Solicitante</th>\n            <th>material solicitado</th>\n            <th>cantidad</th>\n            <th>Fecha de prestamo</th>\n            <th>Fecha de devolucion</th>\n            <th>estado</th>\n            <th>Acción</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr\n            class=\"trMb\"\n            v-for=\"solicitud in datosPaginados\"\n            :key=\"solicitud.id\"\n            :class=\"{ 'solicitud-aceptada': solicitud.estado === 2 ,\n            'solicitud-rechazada': solicitud.estado === 0,\n            'retrasado': solicitud.estado === 5,\n            'pendiente': solicitud.estado === 4,\n            \n             }\"\n\n          >\n            <td data-titulo=\"Solicitante: \">\n              {{ NombreSolicitate[solicitud.id] }}\n            </td>\n            <td data-titulo=\"material solicitado: \">{{ solicitud.titulo }}</td>\n            <td data-titulo=\"Cantidad: \">{{ solicitud.cantidad }}</td>\n            <td data-titulo=\"Fecha de prestamo: \">\n              {{ solicitud.fechaPrestamo }}\n            </td>\n            <td data-titulo=\"Fecha de devolución: \">\n              {{ solicitud.fechaDevolucion }}\n            </td>\n            <td data-titulo=\"Estado: \">\n              <p v-if=\"solicitud.estado == 0\">Solicitud rechazada</p>\n              <p v-if=\"solicitud.estado == 1\">Pendiente de respuesta</p>\n              <p v-if=\"solicitud.estado == 2\">Solicitud aceptada</p>\n              <p v-if=\"solicitud.estado == 3\">material devuelto</p>\n              <p v-if=\"solicitud.estado == 4\">Pendiente de devolucion</p>\n              <p v-if=\"solicitud.estado == 5\">Retrasado</p>\n            </td>\n            <td data-titulo=\"Acción: \">\n              <a\n                v-if=\"solicitud.estado == 1 || solicitud.estado == 2\"\n                @click=\"\n                  eliminarSolicitud(solicitud, NombreSolicitate[solicitud.id])\n                \"\n                class=\"btn btn-danger\"\n                role=\"button\"\n                >👎🏻</a\n              >\n              <a\n                v-if=\"solicitud.estado == 0 || solicitud.estado == 1\"\n                @click=\"\n                  aceptarSolicitud(solicitud, NombreSolicitate[solicitud.id])\n                \"\n                class=\"btn btn-success\"\n                role=\"button\"\n              >\n                👍🏻\n              </a>\n\n              <a\n                v-if=\"solicitud.estado == 2\"\n                @click=\"entregarMaterial(solicitud)\"\n                class=\"btn btn-warning\"\n                role=\"button\"\n                >📦</a\n              >\n              <a\n                v-if=\"solicitud.estado == 4 || solicitud.estado == 5\"\n                @click=\"devolverMaterial(solicitud)\"\n                class=\"btn btn-info\"\n                role=\"button\"\n                >🔙</a\n              >\n              <a\n                v-if=\"solicitud.estado != 0\"\n                @click=\"\n                  imprimirSolicitud(solicitud, NombreSolicitate[solicitud.id])\n                \"\n                class=\"btn btn-primary\"\n                role=\"button\"\n                >🖨️</a\n              >\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</template>\n<script>\nimport axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\nimport { jsPDF } from \"jspdf\";\nimport \"jspdf-autotable\";\nexport default {\n  data() {\n    return {\n      elementosPorPagina: 5,\n      busquedaCodigo: \"\",\n      fechaInicio: \"\",\n      fechaFin: \"\",\n      estado: -1,\n      solicitudes: [],\n      materiales: [],\n      preTitulo: {},\n\n      solicitudesFiltradas: [],\n      datosPaginados: [],\n      paginaActual: 1,\n      NombreSolicitate: [],\n    };\n  },\n  mounted() {\n    this.obtenersolicitudes();\n  },\n\n  methods: {\n    cambiarRegistrosPorPagina() {\n      this.paginaActual = 1;\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n    obtenersolicitudes() {\n      fetch(\n        RUTA_SERVIDOR_LIBROS + \"/prestamo/\" + localStorage.getItem(\"idSubsede\")\n      )\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          this.solicitudes = datosRespuesta.reverse();\n        })\n        .then(() => {\n          for (let index = 0; index < this.solicitudes.length; index++) {\n            this.asignarNombre(\n              this.solicitudes[index].codigoUsuario,\n              this.solicitudes[index].id\n            );\n          }\n        })\n        .catch(console.log);\n    },\n\n    asignarNombre(codigoAlumnon, index) {\n      if (this.NombreSolicitate[index] == undefined) {\n        fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + codigoAlumnon)\n          .then((respuesta) => respuesta.json())\n          .then((datosRespuesta) => {\n            this.filtrarSolicitudes();\n            this.NombreSolicitate[index] =\n              datosRespuesta.nombre +\n              \" \" +\n              datosRespuesta.ap_paterno +\n              \" \" +\n              datosRespuesta.ap_materno;\n          });\n      } else {\n        return;\n      }\n    },\n    quitarAcentosYMinusculas(cadena) {\n      return cadena\n        .normalize(\"NFD\")\n        .replace(/[\\u0300-\\u036f]/g, \"\")\n        .toLowerCase();\n    },\n    filtrarSolicitudes() {\n      // Filtrar por estado\n      let solicitudesFiltradas = this.solicitudes.filter((solicitud) => {\n        return this.estado == -1 || solicitud.estado === parseInt(this.estado);\n      });\n\n      if (this.fechaInicio !== \"\" && this.fechaFin !== \"\") {\n        solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n          return (\n            solicitud.fechaPrestamo >= this.fechaInicio &&\n            solicitud.fechaPrestamo <= this.fechaFin\n          );\n        });\n      }\n\n      // Filtrar por código de usuario (coincidencia parcial)\n      if (this.busquedaCodigo !== \"\") {\n        const busquedaNormalizada = this.quitarAcentosYMinusculas(\n          this.busquedaCodigo\n        );\n        solicitudesFiltradas = solicitudesFiltradas.filter((solicitud) => {\n          const codigoUsuarioNormalizado = this.quitarAcentosYMinusculas(\n            solicitud.codigoUsuario\n          );\n          const tituloNormalizado = this.quitarAcentosYMinusculas(\n            solicitud.titulo\n          );\n          return (\n            codigoUsuarioNormalizado.includes(busquedaNormalizada) ||\n            tituloNormalizado.includes(busquedaNormalizada)\n          );\n        });\n        // No es necesario repetir el bloque de fecha aquí\n      } else {\n        // Si no hay cadena de búsqueda, mantener los filtros anteriores\n        // (no es necesario cambiar nada aquí)\n      }\n\n      // El resto del código permanece igual\n      this.solicitudesFiltradas = solicitudesFiltradas;\n\n      // Realizar alguna acción, como obtener datos de una página\n      this.ObtenerDatosPag(1);\n\n      // Manejo de errores o retroceso de página si no se encontraron resultados\n      if (solicitudesFiltradas.length === 0) {\n        this.paginaPrevia();\n      }\n    },\n    totalPaginas() {\n      if (this.elementosPorPagina === -1) {\n        return 1; // Mostrar todo en una sola página\n      }\n      return Math.ceil(\n        this.solicitudesFiltradas.length / this.elementosPorPagina\n      );\n    },\n    ObtenerDatosPag(noPag) {\n      this.paginaActual = noPag;\n      this.datosPaginados = [];\n\n      let ini = noPag * this.elementosPorPagina - this.elementosPorPagina;\n      let fin = noPag * this.elementosPorPagina;\n      this.datosPaginados = this.solicitudesFiltradas.slice(ini, fin);\n    },\n\n    paginaPrevia() {\n      if (this.paginaActual > 1) {\n        this.paginaActual--;\n      }\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n    paginaSiguiente() {\n      if (this.paginaActual < this.totalPaginas()) {\n        this.paginaActual++;\n      }\n      this.ObtenerDatosPag(this.paginaActual);\n    },\n    activo(noPoag) {\n      return noPoag === this.paginaActual ? \"active\" : \"\";\n    },\n\n    eliminarSolicitud(solicitud, nombre) {\n      const confirmacion = window.confirm(\n    '¿Estás seguro de que deseas cancelar esta solicitud?'\n  );\n\n  if (confirmacion) {\n      var valor;\n      if (solicitud.estado == 2) {\n        valor = 1;\n      } else {\n        valor = 0;\n      }\n\n      try {\n        axios\n          .put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            idSubsede: solicitud.idSubsede,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"Prestamo rechazado por el bibliotecario\",\n            estado: 0,\n            activo: 1,\n            telefono: solicitud.telefono,\n          })\n          .then(function () {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial)\n              .then((respuesta) => respuesta.json())\n              .then((datosRespuesta) => {\n                {\n                  axios\n                    .put(\n                      RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial,\n                      {\n                        titulo: datosRespuesta.titulo,\n                        copias: datosRespuesta.copias,\n                        idTipomaterial:datosRespuesta.idTipomaterial,\n                        copiasDisponibles:\n                          datosRespuesta.copiasDisponibles + valor,\n                        \n                        edicion: datosRespuesta.edicion,\n                        codigo: datosRespuesta.codigo,\n                        idAutor: parseInt(datosRespuesta.idAutor),\n                        idEmpleado: datosRespuesta.idEmpleado,\n                        idEditorial: parseInt(datosRespuesta.idEditorial),\n                        idCarrera: parseInt(datosRespuesta.idCarrera),\n                        urlPortada: datosRespuesta.urlPortada,\n                        observacion: datosRespuesta.observacion,\n                        activo: 1,\n                      }\n                    )\n                    .then(function () {\n                      if (solicitud.telefono != null) {\n                        window.open(\n                          \"https://api.whatsapp.com/send?phone=591\" +\n                            solicitud.telefono +\n                            \"&text=Hola \" +\n                            nombre +\n                            \", nos comunicamos desde la Universidad Nacional del Oriente sede \" +\n                            localStorage.getItem(\"Subsede\") +\n                            ', para informarte que tu solicitus del material \"' +\n                            solicitud.titulo +\n                            '\" a sido rechazada, lamentamos este inconveniente y te pedimos que puedas pasar personalmente por la universidad a realizar la solicitud'\n                        );\n                      }\n                    })\n                    .then(function () {\n                      location.reload();\n                    })\n\n                    .catch(function (error) {\n                      console.log(error);\n                    });\n                }\n              })\n              .catch(console.log);\n          });\n      } catch (error) {\n        console.log(error);\n        // console.log(this.material);\n      }\n    }},\n\n    aceptarSolicitud(solicitud, nombre) {\n      const confirmacion = window.confirm(\n    '¿Estás seguro de que deseas acptar esta solicitud?'\n  );\n\n  if (confirmacion) {\n      try {\n        axios\n          .put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            idSubsede: solicitud.idSubsede,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"Prestamo aceptado por el bibliotecario\",\n            estado: 2,\n            activo: 1,\n            telefono: solicitud.telefono,\n          })\n          .then(function () {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial)\n              .then((respuesta) => respuesta.json())\n              .then((datosRespuesta) => {\n                {\n                  axios\n                    .put(\n                      RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial,\n                      {\n                        titulo: datosRespuesta.titulo,\n                        copias: datosRespuesta.copias,\n                        idTipomaterial:datosRespuesta.idTipomaterial,\n                        copiasDisponibles: datosRespuesta.copiasDisponibles - 1,\n                       \n                        edicion: datosRespuesta.edicion,\n                        codigo: datosRespuesta.codigo,\n                        idAutor: parseInt(datosRespuesta.idAutor),\n                        idEmpleado: datosRespuesta.idEmpleado,\n                        idEditorial: parseInt(datosRespuesta.idEditorial),\n                        idCarrera: parseInt(datosRespuesta.idCarrera),\n                        urlPortada: datosRespuesta.urlPortada,\n                        observacion: datosRespuesta.observacion,\n                        activo: 1,\n                      }\n                    )\n                    .then(function () {\n                      if (solicitud.telefono != null) {\n                        window.open(\n                          \"https://api.whatsapp.com/send?phone=591\" +\n                            solicitud.telefono +\n                            \"&text=Hola%20\" +\n                            nombre +\n                            \",nos comunicamos desde la Universidad Nacional del Oriente sede%20\" +\n                            localStorage.getItem(\"Subsede\") +\n                            ', para informarte que tu solicitus del material \"' +\n                            solicitud.titulo +\n                            '\" a sido aprobada, y puedes pasar a recogerlo en la fecha prevista.'\n                        );\n                      }\n                    })\n                    .then(function () {\n                      location.reload();\n                    })\n\n                    .catch(function (error) {\n                      console.log(error);\n                    });\n                }\n              })\n              .catch(console.log);\n          });\n      } catch (error) {\n        console.log(error);\n        // console.log(this.material);\n      }\n    }},\n\n    devolverMaterial(solicitud) {\n      const confirmacion = window.confirm(\"¿Estás seguro de que deseas devolver el material?\");\n\n  if (confirmacion) {\n\n      var estado1 = 0;\n      if (solicitud.estado == 3) {\n        estado1 = 4;\n      }\n      if (solicitud.estado == 4 || solicitud.estado == 5) {\n        estado1 = 3;\n      }\n      axios\n        .put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n          idEmpleado: solicitud.idEmpleado,\n          codigoUsuario: solicitud.codigoUsuario,\n          idMaterial: solicitud.idMaterial,\n          cantidad: solicitud.cantidad,\n          idSubsede: solicitud.idSubsede,\n          fechaPrestamo: solicitud.fechaPrestamo,\n          fechaDevolucion: solicitud.fechaDevolucion,\n          observacion: \"material devulto\",\n          estado: estado1,\n          activo: 1,\n          telefono: solicitud.telefono,\n        })\n        .then(function () {\n          if (estado1 == 3) {\n            fetch(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial)\n              .then((respuesta) => respuesta.json())\n              .then((datosRespuesta) => {\n                axios\n                  .put(RUTA_SERVIDOR_LIBROS + \"/materiales/\" + solicitud.idMaterial, {\n                    titulo: datosRespuesta.titulo,\n                    copias: datosRespuesta.copias,\n                    idTipomaterial:datosRespuesta.idTipomaterial,\n                    copiasDisponibles: datosRespuesta.copiasDisponibles + 1,\n              \n                    edicion: datosRespuesta.edicion,\n                    codigo: datosRespuesta.codigo,\n                    idAutor: parseInt(datosRespuesta.idAutor),\n                    idEmpleado: datosRespuesta.idEmpleado,\n                    idEditorial: parseInt(datosRespuesta.idEditorial),\n                    idCarrera: parseInt(datosRespuesta.idCarrera),\n                    urlPortada: datosRespuesta.urlPortada,\n                    observacion: datosRespuesta.observacion,\n                    activo: 1,\n                  })\n\n                  .then(function () {\n                    location.reload();\n                  })\n\n                  .catch(function (error) {\n                    console.log(error);\n                  });\n              })\n              .catch(console.log);\n          } else {\n            location.reload();\n          }\n        })\n        .catch(function (error) {\n          console.log(error);\n          // console.log(this.material);\n        });\n      }\n    },\n    exportarAExcel() {\n      // Crear una tabla HTML con los datos que deseas exportar\n      const tabla = document.createElement(\"table\");\n      const thead = tabla.createTHead();\n      const tbody = tabla.createTBody();\n\n      // Agregar encabezados de columna a la tabla\n      const encabezados = [\n        \"Solicitante\",\n        \"material solicitado\",\n        \"Cantidad\",\n        \"Fecha de préstamo\",\n        \"Fecha de devolución\",\n        \"Estado\",\n      ];\n      const encabezadosRow = thead.insertRow();\n      encabezados.forEach((encabezado) => {\n        const th = document.createElement(\"th\");\n        th.innerText = encabezado;\n        encabezadosRow.appendChild(th);\n      });\n\n      // Agregar filas de datos a la tabla\n      this.datosPaginados.forEach((solicitud) => {\n        const fila = tbody.insertRow();\n        fila.insertCell().innerText = this.NombreSolicitate[solicitud.id];\n        fila.insertCell().innerText = solicitud.titulo;\n        fila.insertCell().innerText = solicitud.cantidad;\n        fila.insertCell().innerText = solicitud.fechaPrestamo;\n        fila.insertCell().innerText = solicitud.fechaDevolucion;\n        fila.insertCell().innerText =\n          solicitud.estado === 0\n            ? \"Solicitud rechazada\"\n            : solicitud.estado === 1\n            ? \"Pendiente de respuesta\"\n            : solicitud.estado === 2\n            ? \"Solicitud aceptada\"\n            : solicitud.estado === 3\n            ? \"material devuelto\"\n            : solicitud.estado === 4\n            ? \"Pendiente de devolución\"\n            : solicitud.estado === 5\n            ? \"Retrasado\"\n            :\"noc\"\n      });\n\n      // Crear un archivo Blob para la tabla HTML\n      const blob = new Blob([tabla.outerHTML], {\n        type: \"application/vnd.ms-excel\",\n      });\n\n      // Crear un enlace para descargar el archivo Excel\n      const link = document.createElement(\"a\");\n      link.href = URL.createObjectURL(blob);\n      link.download = \"solicitudes.xls\";\n\n      // Simular un clic en el enlace para iniciar la descarga\n      link.click();\n    },\n\n    entregarMaterial(solicitud) {\n      const confirmacion = window.confirm(\n    '¿Estás seguro de que deseas entregar el material solicitado?'\n  );\n\n  if (confirmacion) {\n      try {\n        var estado1 = 0;\n        if (solicitud.estado == 4) {\n          estado1 = 2;\n        }\n        if (solicitud.estado == 2) {\n          estado1 = 4;\n        }\n        axios\n          .put(RUTA_SERVIDOR_LIBROS + \"/prestamos/\" + solicitud.id, {\n            idEmpleado: solicitud.idEmpleado,\n            codigoUsuario: solicitud.codigoUsuario,\n            idMaterial: solicitud.idMaterial,\n            cantidad: solicitud.cantidad,\n            idSubsede: solicitud.idSubsede,\n            fechaPrestamo: solicitud.fechaPrestamo,\n            fechaDevolucion: solicitud.fechaDevolucion,\n            observacion: \"material entregado por el bibliotecario\",\n            estado: estado1,\n            activo: 1,\n            telefono: solicitud.telefono,\n          })\n          .then(function () {\n            location.reload();\n          });\n      } catch (error) {\n        console.log(error);\n        // console.log(this.material);\n      }\n      }\n    },\n    imprimirSolicitud(solicitud, nombre) {\n      //crear archivo pdf\n      var doc = new jsPDF();\n      doc.setFontSize(20);\n      doc.text(20, 20, \"Solicitud de prestamo\");\n      //colocar logo\n      doc.addImage;\n      doc.text(180, 20, \"UNO\");\n      doc.setFontSize(12);\n      doc.text(20, 30, \"Nombre: \" + nombre);\n      doc.text(20, 40, \"Codigo de usuario: \" + solicitud.codigoUsuario);\n      doc.text(20, 50, \"material: \" + solicitud.titulo);\n      doc.text(20, 60, \"Cantidad: \" + solicitud.cantidad);\n      doc.text(20, 70, \"Fecha de prestamo: \" + solicitud.fechaPrestamo);\n      doc.text(20, 80, \"Fecha de devolucion: \" + solicitud.fechaDevolucion);\n      doc.text(20, 100, \"Firma del alumno:______________________\");\n      doc.text(\n        0,\n        140,\n        \"----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------\"\n      );\n\n      doc.setFontSize(20);\n      doc.text(20, 170, \"Solicitud de prestamo\");\n      doc.text(180, 170, \"UNO\");\n      doc.setFontSize(12);\n      doc.text(20, 180, \"Nombre: \" + nombre);\n      doc.text(20, 190, \"Codigo de usuario: \" + solicitud.codigoUsuario);\n      doc.text(20, 200, \"material: \" + solicitud.titulo);\n      doc.text(20, 210, \"Cantidad: \" + solicitud.cantidad);\n      doc.text(20, 220, \"Fecha de prestamo: \" + solicitud.fechaPrestamo);\n      doc.text(20, 230, \"Fecha de devolucion: \" + solicitud.fechaDevolucion);\n      doc.text(20, 250, \"Firma del alumno:______________________\");\n      // doc.text(20, 90, \"Observacion: \" + solicitud.observacion);\n      // doc.text(20, 100, \"Estado: \" + solicitud.estado);\n      // doc.text(20, 110, \"Subsede: \" + solicitud.subsede);\n      // doc.text(20, 120, \"Telefono: \" + solicitud.telefono);\n      doc.save(\"solicitud.pdf\");\n    },\n\n    imprimirSolicitudes() {\n      // Crear un nuevo documento PDF\n      var doc = new jsPDF();\n//titulo\ndoc.setFontSize(16);\n  var title = \"Solicitudes\";\n  var titleWidth = doc.getStringUnitWidth(title) * doc.internal.getFontSize() / doc.internal.scaleFactor;\n  var pageWidth = doc.internal.pageSize.getWidth();\n  var x = (pageWidth - titleWidth) / 2;\n  doc.text(title, x, 10);\n  // Obtener la tabla visible\n  var table = document.querySelector('.tableMb');\n\n      // Obtener la tabla visible\n      var table = document.querySelector(\".tableMb\");\n\n      // Configurar los estilos de la tabla\n      var styles = {\n        overflow: \"linebreak\",\n        fontSize: 8, // Tamaño de fuente reducido\n        lineWidth: 0.1,\n        lineColor: [0, 0, 0], // Color de las líneas\n        font: \"helvetica\",\n        fontStyle: \"normal\",\n        halign: \"center\", // Alineación horizontal\n        valign: \"middle\", // Alineación vertical\n        cellPadding: 2,\n        tableWidth: \"auto\",\n        tableBorder: 1,\n        tableLineColor: [0, 0, 0], // Color del borde de la tabla\n        tableFillColor: [255, 255, 255], // Color de fondo de la tabla\n        textColor: 0,\n        cellWidth: \"auto\", // Ajustar el ancho de la celda automáticamente\n      };\n\n      // Ocultar la última columna (Acción) antes de agregar la tabla al documento PDF\n      var actionColumn = table.querySelector(\"th:last-child, td:last-child\");\n      if (actionColumn) {\n        actionColumn.style.display = \"none\";\n      }\n\n      // Agregar la tabla al documento PDF\n      doc.autoTable({ html: table, startY: 20, styles });\n\n      // Mostrar la última columna nuevamente\n      if (actionColumn) {\n        actionColumn.style.display = \"table-cell\";\n      }\n\n      // Guardar el PDF\n      doc.save(\"solicitudes.pdf\");\n    },\n  },\n};\n</script>\n<style>\n.solicitud-aceptada {\n  background-color: rgb(154, 255, 166); /* Color verde claro */\n}\n.solicitud-rechazada {\n  background-color: rgb(255, 182, 182); /* Color verde claro */\n}\n.retrasado{\n  background-color:rgb(255, 87, 87)\n}\n.pendiente{\n  background-color:rgb(157, 222, 255)\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}