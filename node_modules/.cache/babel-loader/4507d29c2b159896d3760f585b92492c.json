{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\nexport default {\n  data() {\n    return {\n      modalCarga: '',\n      idAdmin: localStorage.getItem('id'),\n      usuario: {\n        cod_alum: localStorage.getItem(\"cod_alum\"),\n        nombre: localStorage.getItem(\"nombre\"),\n        apellidoP: localStorage.getItem(\"ap_paterno\"),\n        apellidoM: localStorage.getItem(\"ap_materno\"),\n        ci_pasaporte: localStorage.getItem(\"ci_pasaporte\")\n      },\n      cod_alum: '',\n      nombre: '',\n      apellidoP: '',\n      apellidoM: '',\n      fechas: {\n        inicio: \"\",\n        fin: \"\"\n      },\n      telefono: null\n    };\n  },\n\n  props: {\n    Libro: {}\n  },\n  methods: {\n    prestamo(libro) {\n      // ver si hay libro disponible\n      fetch(RUTA_SERVIDOR_LIBROS + \"/libros/\" + libro).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        if (datosRespuesta.copiasDisponibles > 0) {\n          axios.post(RUTA_SERVIDOR_LIBROS + \"/prestamos/\", {\n            idEmpleado: parseInt(localStorage.getItem('id')),\n            codigoUsuario: localStorage.getItem(\"cod_alum\"),\n            idLibro: libro,\n            cantidad: 1,\n            fechaPrestamo: this.fechas.inicio,\n            fechaDevolucion: this.fechas.fin,\n            observacion: \"null\",\n            estado: 1,\n            activo: 1,\n            telefono: this.telefono,\n            idSubsede: localStorage.getItem('idSubsede')\n          }).then(function (response) {\n            this.modalCarga = 'Solicitud realizada';\n            console.log(response);\n          }).catch(function (error) {\n            console.log(error);\n          });\n        } else {\n          alert(\"No hay copias disponibles\");\n        }\n      }).catch(console.log);\n    },\n\n    VerificarLogin(libro) {\n      fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + localStorage.getItem(\"cod_alum\") + \"/\" + localStorage.getItem(\"ci_pasaporte\")).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        if (datosRespuesta != \"\") {\n          var fechaActual = new Date().getTime();\n          console.log(fechaActual);\n          var fechaInicio = new Date(this.fechas.inicio).getTime();\n          var fechaFin = new Date(this.fechas.fin).getTime();\n          console.log(fechaInicio);\n          var tiempo = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24);\n\n          if (fechaInicio >= fechaActual) {\n            if (tiempo < 15 && tiempo >= 0) {\n              this.modalCarga = 'Solicitando';\n              this.prestamo(libro);\n            } else {\n              alert(\"El tiempo del préstamo debe ser entre 1 y 15 días\");\n            }\n          } else {\n            alert(\"La fecha debe ser mayor o igual a la fecha actual\");\n          }\n        }\n      }).catch(function () {\n        localStorage.setItem(\"acceso\", 0);\n        localStorage.setItem(\"cod_alum\", \"\");\n        localStorage.setItem(\"ci_pasaporte\", \"\");\n        localStorage.setItem(\"nombre\", \"\");\n        localStorage.setItem(\"ap_paterno\", \"\");\n        localStorage.setItem(\"ap_materno\", \"\");\n        localStorage.setItem(\"sede\", \"\");\n        localStorage.setItem(\"id\", 0);\n        location.reload();\n        this.$router.push(\"/\");\n      });\n    },\n\n    VerificarAlumno(libro) {\n      fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + this.cod_alum).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        if (datosRespuesta != \"\") {\n          var fechaActual = new Date().getTime();\n          console.log(fechaActual);\n          var fechaInicio = new Date(this.fechas.inicio).getTime();\n          var fechaFin = new Date(this.fechas.fin).getTime();\n          console.log(fechaInicio);\n          var tiempo = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24);\n\n          if (fechaInicio >= fechaActual) {\n            if (tiempo < 15 && tiempo >= 0) {\n              this.prestamo(libro);\n            } else {\n              alert(\"El tiempo del préstamo debe ser entre 1 y 15 días\");\n            }\n          } else {\n            alert(\"La fecha debe ser mayor o igual a la fecha actual\");\n          }\n        }\n      }).catch(function () {\n        alert(\"Existen datos incorrectos\");\n      });\n    },\n\n    buscarAlumno() {\n      fetch(RUTA_SERVIDOR_ALUMNOS + \"/alumno/\" + this.cod_alum).then(respuesta => respuesta.json()).then(datosRespuesta => {\n        this.nombre = datosRespuesta.nombre;\n        this.apellidop = datosRespuesta.ap_paterno;\n        this.apellidoM = datosRespuesta.ap_materno;\n        localStorage.setItem(\"cod_alum\", datosRespuesta.cod_alum);\n      }).catch(this.nombre = 'Usuario no encontrado', this.apellidop = '', this.apellidoM = '', localStorage.setItem(\"cod_alum\", '')).catch(console.clear);\n    }\n\n  }\n};","map":{"version":3,"mappings":";AAiKA;AACA;AACA;AAGA;EAEAA;IACA;MAEAC,cAFA;MAGAC,mCAHA;MAIAC;QACAC,0CADA;QAEAC,sCAFA;QAGAC,6CAHA;QAIAC,6CAJA;QAKAC;MALA,CAJA;MAYAJ,YAZA;MAaAC,UAbA;MAcAC,aAdA;MAeAC,aAfA;MAiBAE;QACAC,UADA;QAEAC;MAFA,CAjBA;MAqBAC;IArBA;EAuBA,CA1BA;;EA4BAC;IACAC;EADA,CA5BA;EAgCAC;IACAC;MACA;MACAC,iDACAC,IADA,CACAC,6BADA,EAEAD,IAFA,CAEAE;QACA;UACAC,MACAC,IADA,CACAC,oCADA,EACA;YACAC,gDADA;YAEAC,+CAFA;YAGAC,cAHA;YAIAC,WAJA;YAKAC,iCALA;YAMAC,gCANA;YAOAC,mBAPA;YAQAC,SARA;YASAC,SATA;YAUApB,uBAVA;YAWAqB;UAXA,CADA,EAcAf,IAdA,CAcA;YACA;YACAgB;UAGA,CAnBA,EAoBAC,KApBA,CAoBA;YACAD;UACA,CAtBA;QAuBA,CAxBA,MAwBA;UACAE;QACA;MACA,CA9BA,EA+BAD,KA/BA,CA+BAD,WA/BA;IAgCA,CAnCA;;IAqCAG;MAEApB,MACAqB,qCACAC,gCADA,GAEA,GAFA,GAGAA,oCAJA,EAMArB,IANA,CAMAC,6BANA,EAOAD,IAPA,CAOAE;QAEA;UACA;UACAc;UACA;UAEA;UACAA;UACA;;UACA;YACA;cACA;cACA;YACA,CAHA,MAGA;cACAE;YACA;UACA,CAPA,MAOA;YACAA;UACA;QACA;MACA,CA5BA,EA6BAD,KA7BA,CA6BA;QACAI;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAA;QACAC;QACA;MACA,CAxCA;IAyCA,CAhFA;;IAqFAC;MACAxB,MACAqB,qCACA,aAFA,EAIApB,IAJA,CAIAC,6BAJA,EAKAD,IALA,CAKAE;QACA;UACA;UACAc;UACA;UAEA;UACAA;UACA;;UACA;YACA;cACA;YACA,CAFA,MAEA;cACAE;YACA;UACA,CANA,MAMA;YACAA;UACA;QACA;MACA,CAxBA,EAyBAD,KAzBA,CAyBA;QACAC;MACA,CA3BA;IA4BA,CAlHA;;IAuHAM;MAEAzB,0DACAC,IADA,CACAC,6BADA,EAEAD,IAFA,CAEAE;QACA;QACA;QACA;QACAmB;MAEA,CARA,EASAJ,KATA,CASA,qCATA,EAUA,mBAVA,EAWA,mBAXA,EAYAI,oCAZA,EAaAJ,KAbA,CAaAD,aAbA;IAcA;;EAvIA;AAhCA","names":["data","modalCarga","idAdmin","usuario","cod_alum","nombre","apellidoP","apellidoM","ci_pasaporte","fechas","inicio","fin","telefono","props","Libro","methods","prestamo","fetch","then","respuesta","datosRespuesta","axios","post","RUTA_SERVIDOR_LIBROS","idEmpleado","codigoUsuario","idLibro","cantidad","fechaPrestamo","fechaDevolucion","observacion","estado","activo","idSubsede","console","catch","alert","VerificarLogin","RUTA_SERVIDOR_ALUMNOS","localStorage","location","VerificarAlumno","buscarAlumno"],"sourceRoot":"src/components","sources":["modalPrestamo.vue"],"sourcesContent":["<template>\n<div class=\"row modalCompleto\">\n<img class=\"col-6\" v-bind:src=\"''+Libro.urlPortada\"/>\n  <div class=\"col-6\"> \n    <div>\n      <div>{{modalCarga}}</div>\n        <label\n          >Libro solicitado: {{ Libro.nombreLibro }}. <br />\n          Autor: {{ Libro.autor }}. <br />Editorial:\n          {{ Libro.editorial }}.<br />\n          Edición: {{ Libro.edicion }}</label\n        >\n      </div>\n      \n      <hr>\n    <div class=\"form-group\">\n\n\n\n\n      <div v-if=\"idAdmin==0 || idAdmin==null ||  idAdmin==undefined \">\n      <div>\n        <label for=\"\"\n          >Nombre Completo: {{ usuario.nombre }} {{ usuario.apellidoP }}\n          {{ usuario.apellidoM }}</label\n        >\n      </div>\n      <div class=\"row\">\n        <div class=\"col-6\">\n          <label for=\"\">Codigo de alumno</label>\n          <input\n            type=\"text\"\n            class=\"form-control\"\n            name=\"codigoUsuario\"\n            id=\"\"\n            v-bind:value=\"usuario.cod_alum\"\n            aria-describedby=\"helpId\"\n            placeholder=\"\"\n            readonly\n          />\n        </div>\n        <div class=\"col-6\">\n          <label for=\"\">Ci/Pasaporte</label>\n          <input\n            type=\"password\"\n            class=\"form-control\"\n            name=\"codigoUsuario\"\n            id=\"\"\n            v-bind:value=\"usuario.ci_pasaporte\"\n            aria-describedby=\"helpId\"\n            placeholder=\"\"\n            readonly\n          />\n        </div>\n      </div>\n      <br />\n      \n      <div>\n        <label for=\"\">Cantidad</label>\n        <input\n          type=\"number\"\n          class=\"form-control\"\n          name=\"codigoUsuario\"\n          id=\"\"\n          v-bind:value=\"1\"\n          aria-describedby=\"helpId\"\n          placeholder=\"\"\n          \n        />\n      </div>\n    </div>\n    <div v-else>\n<div>\n        <label for=\"\"\n          >Nombre Completo: {{ nombre }} {{ apellidoP }}\n          {{ apellidoM }}</label\n        >\n      </div>\n      <div class=\"row\">\n        <div class=\"col\">\n          <label for=\"\">Codigo de alumno</label>\n          <input\n            type=\"text\"\n            class=\"form-control\"\n            name=\"codigoUsuario\"\n            id=\"\"\n            v-on:keyup=\"buscarAlumno()\"\n           v-model=\"cod_alum\"\n            aria-describedby=\"helpId\"\n            placeholder=\"\"\n            \n          />\n        </div>\n       \n      </div>\n      <br />\n      \n      <div>\n        <label for=\"\">Cantidad</label>\n        <input\n          type=\"number\"\n          class=\"form-control\"\n          name=\"codigoUsuario\"\n          id=\"\"\n          v-bind:value=\"1\"\n          aria-describedby=\"helpId\"\n          placeholder=\"\"\n          \n        />\n      </div>\n    </div>\n\n\n\n\n      <div>\n        <label for=\"\">Fecha para recoger el Libro</label>\n        <input\n          type=\"date\"\n          v-model=\"fechas.inicio\"\n          class=\"form-control\"\n          aria-describedby=\"helpId\"\n          placeholder=\"\"\n          required\n        />\n      </div>\n      <div>\n        <label for=\"\">Fecha para entregar libro</label>\n        <input\n          type=\"date\"\n          v-model=\"fechas.fin\"\n          class=\"form-control\"\n          aria-describedby=\"helpId\"\n          placeholder=\"\"\n          required\n        />\n      </div>\n      <div >\n        <label for=\"\">Numero de whatsapp</label>\n        <br>\n        <input class=\"col-12\"\n          type=\"number\"\n          aria-describedby=\"helpId\"\n          placeholder=\"Notificara la confirmacion de la solicitud\"\n           v-model=\"telefono\"\n           />\n      </div>\n      <br>\n    </div>\n    <div v-if=\"idAdmin>0\">\n    <button class=\"col-12\" @click=\"VerificarAlumno(Libro.id)\"> Verificar y solicitar Libro</button>\n    </div>\n    <div v-else>\n    <button class=\"col-12 btn-primary\n    \" @click=\"VerificarLogin(Libro.id)\">Solicitar Libro</button>\n    </div>\n  </div>\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nexport const RUTA_SERVIDOR_ALUMNOS = process.env.VUE_APP_RUTA_API_ALUMNOS;\nexport const RUTA_SERVIDOR_LIBROS = process.env.VUE_APP_RUTA_API_LIBROS;\n\n\nexport default {\n  \n  data() {\n    return {\n\n      modalCarga:'',\n      idAdmin:localStorage.getItem('id'),\n      usuario: {\n        cod_alum: localStorage.getItem(\"cod_alum\"),\n        nombre: localStorage.getItem(\"nombre\"),\n        apellidoP: localStorage.getItem(\"ap_paterno\"),\n        apellidoM: localStorage.getItem(\"ap_materno\"),\n        ci_pasaporte: localStorage.getItem(\"ci_pasaporte\"),\n      },\n      \n        cod_alum: '',\n        nombre: '',\n        apellidoP: '',\n        apellidoM: '',\n\n      fechas: {\n        inicio: \"\",\n        fin: \"\",\n      },\n      telefono:null\n    };\n  },\n\n  props: {\n    Libro: {},\n  },\n\n  methods: {\n    prestamo(libro) {\n      // ver si hay libro disponible\n      fetch(RUTA_SERVIDOR_LIBROS+\"/libros/\" + libro)\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          if (datosRespuesta.copiasDisponibles > 0) {\n            axios\n              .post(RUTA_SERVIDOR_LIBROS+\"/prestamos/\", {\n                idEmpleado: parseInt(localStorage.getItem('id')),\n                codigoUsuario: localStorage.getItem(\"cod_alum\"),\n                idLibro: libro,\n                cantidad: 1,\n                fechaPrestamo: this.fechas.inicio,\n                fechaDevolucion: this.fechas.fin,\n                observacion: \"null\",\n                estado: 1,\n                activo: 1,\n                telefono: this.telefono,\n                idSubsede: localStorage.getItem('idSubsede')\n              })\n              .then(function (response) {\n                this.modalCarga='Solicitud realizada' \n                console.log(response);\n               \n                \n              })\n              .catch(function (error) {\n                console.log(error);\n              });\n          } else {\n            alert(\"No hay copias disponibles\");\n          }\n        })\n        .catch(console.log);\n    },\n\n    VerificarLogin(libro) {\n   \n      fetch(\n        RUTA_SERVIDOR_ALUMNOS+\"/alumno/\" +\n          localStorage.getItem(\"cod_alum\") +\n          \"/\" +\n          localStorage.getItem(\"ci_pasaporte\")\n      )\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          \n          if (datosRespuesta != \"\") {\n            var fechaActual = new Date().getTime();\n            console.log(fechaActual);\n            var fechaInicio = new Date(this.fechas.inicio).getTime();\n\n            var fechaFin = new Date(this.fechas.fin).getTime();\n            console.log(fechaInicio);\n            var tiempo = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24);\n            if (fechaInicio >= fechaActual) {\n              if (tiempo < 15 && tiempo >= 0) {\n                this.modalCarga='Solicitando' \n                this.prestamo(libro);\n              } else {\n                alert(\"El tiempo del préstamo debe ser entre 1 y 15 días\");\n              }\n            } else {\n              alert(\"La fecha debe ser mayor o igual a la fecha actual\");\n            }\n          }\n        })\n        .catch(function () {\n          localStorage.setItem(\"acceso\", 0);\n          localStorage.setItem(\"cod_alum\", \"\");\n          localStorage.setItem(\"ci_pasaporte\", \"\");\n          localStorage.setItem(\"nombre\", \"\");\n          localStorage.setItem(\"ap_paterno\", \"\");\n          localStorage.setItem(\"ap_materno\", \"\");\n          localStorage.setItem(\"sede\", \"\");\n          localStorage.setItem(\"id\", 0);\n          location.reload();\n          this.$router.push(\"/\");\n        });\n    },\n\n\n    \n\n    VerificarAlumno(libro) {\n      fetch(\n        RUTA_SERVIDOR_ALUMNOS+\"/alumno/\" +\n          this.cod_alum\n      )\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          if (datosRespuesta != \"\") {\n            var fechaActual = new Date().getTime();\n            console.log(fechaActual);\n            var fechaInicio = new Date(this.fechas.inicio).getTime();\n\n            var fechaFin = new Date(this.fechas.fin).getTime();\n            console.log(fechaInicio);\n            var tiempo = (fechaFin - fechaInicio) / (1000 * 60 * 60 * 24);\n            if (fechaInicio >= fechaActual) {\n              if (tiempo < 15 && tiempo >= 0) {\n                this.prestamo(libro);\n              } else {\n                alert(\"El tiempo del préstamo debe ser entre 1 y 15 días\");\n              }\n            } else {\n              alert(\"La fecha debe ser mayor o igual a la fecha actual\");\n            }\n          }\n        })\n        .catch(function () {\n          alert(\"Existen datos incorrectos\");\n        });\n    },\n\n\n\n\n    buscarAlumno(){\n   \n     fetch(RUTA_SERVIDOR_ALUMNOS+\"/alumno/\" + this.cod_alum)\n        .then((respuesta) => respuesta.json())\n        .then((datosRespuesta) => {\n          this.nombre=datosRespuesta.nombre;\n          this.apellidop=datosRespuesta.ap_paterno;\n          this.apellidoM=datosRespuesta.ap_materno;\n          localStorage.setItem(\"cod_alum\",datosRespuesta.cod_alum)\n\n        })\n        .catch(this.nombre='Usuario no encontrado',\n          this.apellidop='',\n          this.apellidoM='',\n          localStorage.setItem(\"cod_alum\",'')\n         ).catch(console.clear );\n    }\n\n\n\n\n\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n\n</style>\n"]},"metadata":{},"sourceType":"module"}