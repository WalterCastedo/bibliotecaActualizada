{"version":3,"file":"useIntersectionObserver.js","sources":["../../../../src/composables/useIntersectionObserver.ts"],"sourcesContent":["import { onBeforeUnmount, ref, Ref, unref, watch } from 'vue'\n\ntype MaybeRef<T> = T | Ref<T>\n\nexport const useIntersectionObserver = <T extends HTMLElement | undefined>(\n  cb: (entries: IntersectionObserverEntry[], observer: IntersectionObserver) => void,\n  options: MaybeRef<IntersectionObserverInit> = {},\n  targetsList: Ref<MaybeRef<T>[]> = ref([]),\n) => {\n  const observer = ref<IntersectionObserver>()\n\n  const disconnectObserver = () => {\n    observer.value?.disconnect()\n  }\n\n  const observeTarget = (target: MaybeRef<T>) => {\n    const disclosedTarget = unref(target)\n    disclosedTarget && observer.value?.observe(disclosedTarget)\n  }\n\n  const observeAll = (targets: MaybeRef<MaybeRef<T>[]>) => {\n    const disclosedTargets = unref(targets)\n    disclosedTargets.forEach(observeTarget)\n  }\n\n  const initObserver = () => {\n    observer.value = new IntersectionObserver(cb, unref(options))\n  }\n\n  watch([targetsList, options], ([newList, newOptions], [oldList, oldOptions]) => {\n    disconnectObserver()\n\n    if (newOptions !== oldOptions) {\n      if (newList.length) {\n        initObserver()\n        observeAll(newList)\n      }\n\n      return\n    }\n\n    if (newList.length) {\n      if (!observer.value) {\n        initObserver()\n      }\n\n      observeAll(newList)\n    }\n  }, { immediate: true })\n\n  onBeforeUnmount(disconnectObserver)\n\n  return observer\n}\n"],"names":[],"mappings":";AAIa,MAAA,0BAA0B,CACrC,IACA,UAA8C,IAC9C,cAAkC,IAAI,CAAA,CAAE,MACrC;AACH,QAAM,WAAW;AAEjB,QAAM,qBAAqB,MAAM;;AAC/B,mBAAS,UAAT,mBAAgB;AAAA,EAAW;AAGvB,QAAA,gBAAgB,CAAC,WAAwB;;AACvC,UAAA,kBAAkB,MAAM,MAAM;AACjB,uBAAA,gBAAS,UAAT,mBAAgB,QAAQ;AAAA,EAAe;AAGtD,QAAA,aAAa,CAAC,YAAqC;AACjD,UAAA,mBAAmB,MAAM,OAAO;AACtC,qBAAiB,QAAQ,aAAa;AAAA,EAAA;AAGxC,QAAM,eAAe,MAAM;AACzB,aAAS,QAAQ,IAAI,qBAAqB,IAAI,MAAM,OAAO,CAAC;AAAA,EAAA;AAGxD,QAAA,CAAC,aAAa,OAAO,GAAG,CAAC,CAAC,SAAS,aAAa,CAAC,SAAS,gBAAgB;AAC3D;AAEnB,QAAI,eAAe,YAAY;AAC7B,UAAI,QAAQ,QAAQ;AACL;AACb,mBAAW,OAAO;AAAA,MACpB;AAEA;AAAA,IACF;AAEA,QAAI,QAAQ,QAAQ;AACd,UAAA,CAAC,SAAS,OAAO;AACN;MACf;AAEA,iBAAW,OAAO;AAAA,IACpB;AAAA,EAAA,GACC,EAAE,WAAW,KAAA,CAAM;AAEtB,kBAAgB,kBAAkB;AAE3B,SAAA;AACT;;"}